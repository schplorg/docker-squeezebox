var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,b){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var d=c.length,g=a.length;b=Math.max(0,Math.min(b|0,c.length));for(var f=0;f<g&&b<d;)if(c[b++]!=a[f++])return!1;return f>=g}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,b){var c=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===b&&(b=c.length);b=Math.max(0,Math.min(b|0,c.length));for(var d=a.length;0<d&&0<b;)if(c[--b]!=a[--d])return!1;return 0>=d}},"es6","es3");var PQ_STATUS_TAGS=IS_MOBILE?"tags:cdgltyAKNS":"tags:cdegltysAKNS";
function queueItemCover(a,c){if(a.artwork_url)return resolveImageUrl(a.artwork_url);if(a.coverid&&!(""+a.coverid).startsWith("-"))return"/music/"+a.coverid+"/cover"+LMS_IMAGE_SIZE;if(c){if(a.artist_ids)return"/imageproxy/mai/artist/"+a.artist_ids.split(",")[0].trim()+"/image"+LMS_IMAGE_SIZE;if(a.artist_id)return"/imageproxy/mai/artist/"+a.artist_id+"/image"+LMS_IMAGE_SIZE}return resolveImageUrl(LMS_BLANK_COVER)}
function animate(a,c,b){function e(){d>=c?(clearInterval(l),a.style.opacity=g):(d+=k,a.style.opacity=f*d)}var d=c,g=a.style.opacity,f=g?g:1,k=(c-b)/10,l=setInterval(function(){d<=b?(clearInterval(l),l=setInterval(e,40)):(d-=k,a.style.opacity=f*d)},40)}var lastQueueItemClick=void 0;function showArtist(a,c){0<lmsNumVisibleMenus||(lastQueueItemClick=new Date,bus.$emit("browse",["albums"],["artist_id:"+a,"tags:jlys",SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER],unescape(c)))}
function showAlbum(a,c){0<lmsNumVisibleMenus||(lastQueueItemClick=new Date,bus.$emit("browse",["tracks"],["album_id:"+a,TRACK_TAGS,SORT_KEY+"tracknum"],unescape(c)))}function showComposer(a,c){0<lmsNumVisibleMenus||(lastQueueItemClick=new Date,bus.$emit("browse",["albums"],["artist_id:"+a,"tags:jlys",SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,"role_id:COMPOSER"],unescape(c)))}
function buildSubtitle(a,c){var b=void 0;if(a.composer&&a.genre&&LMS_COMPOSER_GENRES.has(a.genre)){var e=!IS_MOBILE&&a.composer_ids?a.composer_ids.split(","):void 0;b=e&&1==e.length?addPart(b,'<a href="#" onclick="showComposer('+e[0]+",'"+escape(a.composer)+"')\">"+a.composer+"</a>"):addPart(b,a.composer)}a.artist?b=IS_MOBILE||void 0==a.artist_id?addPart(b,a.artist):addPart(b,'<a href="#" onclick="showArtist('+a.artist_id+",'"+escape(a.artist)+"')\">"+a.artist+"</a>"):a.trackartist&&(b=IS_MOBILE||
void 0==a.trackartist_id&&void 0==a.artist_id?addPart(b,a.trackartist):addPart(b,'<a href="#" onclick="showArtist('+(void 0!=a.trackartist_id?a.trackartist_id:a.artist_id)+",'"+escape(a.trackartist)+"')\">"+a.trackartist+"</a>"));e=[];c&&(e.push(b),b=void 0);var d=checkRemoteTitle(a);a.album?(d=a.album,a.year&&0<a.year&&(d+=" ("+a.year+")"),a.album_id&&!IS_MOBILE&&(d='<a href="#" onclick="showAlbum('+a.album_id+",'"+escape(d)+"')\">"+d+"</a>"),b=addPart(b,d)):d&&d!=a.title&&(b=addPart(b,d));return c?
(e.push(b),e):b}
function parseResp(a,c,b,e,d,g){logJsonMessage("RESP",a);var f={timestamp:0,items:[],size:0};if(a.result&&(f.timestamp=a.result.playlist_timestamp,f.size=a.result.playlist_tracks,a.result.playlist_loop)){var k=0;a=a.result.playlist_loop;for(var l=a.length;k<l;++k){var h=a[k],m=h.title;c&&0<h.tracknum&&(m=(9<h.tracknum?h.tracknum:"0"+h.tracknum)+SEPARATOR+m);var n=void 0==h.duration?void 0:parseInt(h.duration);f.items.push({id:"track_id:"+h.id,title:e&&void 0!=h.rating?ratingString(m,h.rating):m,subtitle:buildSubtitle(h,
d),image:queueItemCover(h,g),actions:[PQ_PLAY_NOW_ACTION,PQ_PLAY_NEXT_ACTION,DIVIDER,PQ_REMOVE_ACTION,PQ_SELECT_ACTION,PQ_MORE_ACTION],duration:n,durationStr:void 0!=n&&0<n?formatSeconds(n):void 0,key:h.id+"."+b});b++}}return f}
var lmsQueue=Vue.component("lms-queue",{template:'\n<div> \n <v-dialog v-model="dialog.show" persistent max-width="500px">\n  <v-card>\n   <v-card-title>{{dialog.title}}</v-card-title>\n   <v-card-text>\n    <v-text-field single-line v-if="dialog.show" :label="dialog.hint" v-model="dialog.value" autofocus @keyup.enter="dialogResponse(true);"></v-text-field>\n   </v-card-text>\n   <v-card-actions>\n    <v-spacer></v-spacer>\n    <v-btn flat @click.native="dialog.show = false; dialogResponse(false);">{{undefined===dialog.cancel ? trans.cancel : dialog.cancel}}</v-btn>\n    <v-btn flat @click.native="dialogResponse(true);">{{undefined===dialog.ok ? trans.ok : dialog.ok}}</v-btn>\n   </v-card-actions>\n  </v-card>\n </v-dialog>\n\n <div class="subtoolbar list-details noselect" >\n  <v-layout v-if="selection.length>0">\n   <v-layout row wrap>\n    <v-flex xs12 class="ellipsis subtoolbar-title subtoolbar-pad">{{trans.selectMultiple}}</v-flex>\n    <v-flex xs12 class="ellipsis subtoolbar-subtitle subtext">{{selection.length | displaySelectionCount}}</v-flex>\n   </v-layout>\n   <v-spacer></v-spacer>\n   <v-btn :title="trans.remove" flat icon class="toolbar-button" @click="removeSelectedItems()"><v-icon>remove_circle_outline</v-icon></v-btn>\n   <v-divider vertical v-if="desktop"></v-divider>\n   <v-btn :title="trans.cancel" flat icon class="toolbar-button" @click="clearSelection()"><v-icon>cancel</v-icon></v-btn>\n  </v-layout>\n  <v-layout v-else>\n   <div class="ellipsis subtoolbar-title subtoolbar-title-single" v-if="listSize>0">{{listSize | displayCount}}{{duration | displayTime(true)}}</div>\n   <v-spacer></v-spacer>\n   <v-btn :title="trans.repeatOne" flat icon v-if="(desktop || wide>0) && playerStatus.repeat===1" class="toolbar-button" @click="bus.$emit(\'playerCommand\', [\'playlist\', \'repeat\', 0])"><v-icon class="active-btn">repeat_one</v-icon></img></v-btn>\n   <v-btn :title="trans.repeatAll" flat icon v-else-if="(desktop || wide>0) && playerStatus.repeat===2" class="toolbar-button" @click="bus.$emit(\'playerCommand\', [\'playlist\', \'repeat\', 1])"><v-icon class="active-btn">repeat</v-icon></v-btn>\n   <v-btn :title="trans.dstm" flat icon v-else-if="(desktop || wide>0) && dstm" class="toolbar-button" @click="bus.$emit(\'dlg.open\', \'dstm\')"><v-icon class="active-btn">all_inclusive</v-icon></v-btn>\n   <v-btn :title="trans.repeatOff" flat icon v-else-if="desktop || wide>0" class="toolbar-button dimmed" v-longpress="repeatOff"><v-icon>repeat</v-icon></v-btn>\n\n   <v-btn :title="trans.shuffleAlbums" flat icon v-if="(desktop || wide>0) && playerStatus.shuffle===2" class="toolbar-button" @click="bus.$emit(\'playerCommand\', [\'playlist\', \'shuffle\', 0])"><v-icon class="shuffle-albums active-btn">shuffle</v-icon></v-btn>\n   <v-btn :title="trans.shuffleAll" flat icon v-else-if="(desktop || wide>0) && playerStatus.shuffle===1" class="toolbar-button" @click="bus.$emit(\'playerCommand\', [\'playlist\', \'shuffle\', 2])"><v-icon class="active-btn">shuffle</v-icon></v-btn>\n   <v-btn :title="trans.shuffleOff" flat icon v-else-if="desktop || wide>0" class="toolbar-button dimmed" @click="bus.$emit(\'playerCommand\', [\'playlist\', \'shuffle\', 1])"><v-icon>shuffle</v-icon></v-btn>\n   <v-divider vertical v-if="desktop || wide>0"></v-divider>\n   <template v-if="desktop || wide>1" v-for="(action, index) in settingsMenuActions">\n    <v-btn flat icon @click.stop="headerAction(action)" class="toolbar-button" :title="ACTIONS[action].title | tooltip(ACTIONS[action].shortcut,keyboardControl)" :id="\'tbar\'+index">\n      <img v-if="ACTIONS[action].svg" class="svg-img" :src="ACTIONS[action].svg | svgIcon(darkUi)"></img>\n      <v-icon v-else>{{ACTIONS[action].icon}}</v-icon>\n    </v-btn>\n   </template>\n   <v-btn :title="trans.save | tooltip(trans.saveShortcut,keyboardControl)" flat icon @click="save()" class="toolbar-button"><v-icon>save</v-icon></v-btn>\n   <v-btn :title="trans.clear | tooltip(trans.clearShortcut,keyboardControl)" flat icon @click="clear()" class="toolbar-button"><img class="svg-list-img" :src="\'queue-clear\' | svgIcon(darkUi)"></img></v-btn>\n  </v-layout>\n </div>\n <v-list class="lms-list-sub bgnd-cover" id="queue-list" v-bind:class="{\'lms-list-sub3\':threeLines}">\n <RecycleScroller v-if="items.length>LMS_MAX_NON_SCROLLER_ITEMS && threeLines" :items="items" :item-size="LMS_LIST_3LINE_ELEMENT_SIZE" page-mode key-field="key">\n   <v-list-tile avatar v-bind:class="{\'pq-current\': index==currentIndex}" @dragstart="dragStart(index, $event)" @dragend="dragEnd()" @dragover="dragOver($event)" @drop="drop(index, $event)" draggable @click="click(item, index, $event)" slot-scope="{item, index}" key-field="key">\n    <v-list-tile-avatar :tile="true" v-bind:class="{\'radio-image\': 0==item.duration}" class="lms-avatar">\n     <v-icon v-if="item.selected">check_box</v-icon>\n     <img v-else :key="item.image" :src="item.image"></img>\n    </v-list-tile-avatar>\n    <v-list-tile-content>\n     <v-list-tile-title v-html="item.title"></v-list-tile-title>\n     <v-list-tile-sub-title v-html="item.subtitle[0]"></v-list-tile-sub-title>\n     <v-list-tile-sub-title v-html="item.subtitle[1]"></v-list-tile-sub-title>\n    </v-list-tile-content>\n    <v-list-tile-action class="pq-time">{{item.durationStr}}</v-list-tile-action>\n    <v-list-tile-action class="queue-action" @click.stop="itemMenu(item, index, $event)">\n     <v-btn icon><v-icon>more_vert</v-icon></v-btn>\n    </v-list-tile-action>\n   </v-list-tile>\n  </RecycleScroller>\n  <RecycleScroller v-if="items.length>LMS_MAX_NON_SCROLLER_ITEMS" :items="items" :item-size="LMS_LIST_ELEMENT_SIZE" page-mode key-field="key">\n   <v-list-tile avatar v-bind:class="{\'pq-current\': index==currentIndex}" @dragstart="dragStart(index, $event)" @dragend="dragEnd()" @dragover="dragOver($event)" @drop="drop(index, $event)" draggable @click="click(item, index, $event)" slot-scope="{item, index}" key-field="key">\n    <v-list-tile-avatar :tile="true" v-bind:class="{\'radio-image\': 0==item.duration}" class="lms-avatar">\n     <v-icon v-if="item.selected">check_box</v-icon>\n     <img v-else :key="item.image" :src="item.image"></img>\n    </v-list-tile-avatar>\n    <v-list-tile-content>\n     <v-list-tile-title v-html="item.title"></v-list-tile-title>\n     <v-list-tile-sub-title v-html="item.subtitle"></v-list-tile-sub-title>\n    </v-list-tile-content>\n    <v-list-tile-action class="pq-time">{{item.durationStr}}</v-list-tile-action>\n    <v-list-tile-action class="queue-action" @click.stop="itemMenu(item, index, $event)">\n     <v-btn icon><v-icon>more_vert</v-icon></v-btn>\n    </v-list-tile-action>\n   </v-list-tile>\n  </RecycleScroller>\n  <template v-else v-for="(item, index) in items">\n   <v-list-tile :key="item.key" avatar v-bind:class="{\'pq-current\': index==currentIndex}" :id="\'track\'+index" @dragstart="dragStart(index, $event)" @dragend="dragEnd()" @dragover="dragOver($event)" @drop="drop(index, $event)" draggable @click="click(item, index, $event)" class="lms-list-item">\n    <v-list-tile-avatar :tile="true" v-bind:class="{\'radio-image\': 0==item.duration}" class="lms-avatar">\n     <v-icon v-if="item.selected">check_box</v-icon>\n     <img v-else :key="item.image" :src="item.image"></img>\n    </v-list-tile-avatar>\n    <v-list-tile-content>\n     <v-list-tile-title v-html="item.title"></v-list-tile-title>\n     <v-list-tile-sub-title v-if="!threeLines" v-html="item.subtitle"></v-list-tile-sub-title>\n     <v-list-tile-sub-title v-if="threeLines" v-html="item.subtitle[0]"></v-list-tile-sub-title>\n     <v-list-tile-sub-title v-if="threeLines" v-html="item.subtitle[1]"></v-list-tile-sub-title>\n    </v-list-tile-content>\n    <v-list-tile-action class="pq-time">{{item.durationStr}}</v-list-tile-action>\n    <v-list-tile-action class="queue-action" @click.stop="itemMenu(item, index, $event)">\n     <v-btn icon><v-icon>more_vert</v-icon></v-btn>\n    </v-list-tile-action>\n   </v-list-tile>\n  </template>\n  <v-list-tile class="lms-list-pad"></v-list-tile>\n </v-list>\n\n <v-menu offset-y v-model="menu.show" :position-x="menu.x" :position-y="menu.y">\n  <v-list v-if="menu.item">\n   <template v-for="(action, index) in menu.item.actions">\n    <v-divider v-if="DIVIDER==action"></v-divider>\n    <v-list-tile v-else @click="itemAction(action, menu.item, menu.index)">\n     <v-list-tile-avatar v-if="menuIcons">\n      <v-icon v-if="undefined==ACTIONS[action].svg">{{ACTIONS[action].icon}}</v-icon>\n      <img v-else class="svg-img" :src="ACTIONS[action].svg | svgIcon(darkUi)"></img>\n     </v-list-tile-avatar>\n     <v-list-tile-title>{{ACTIONS[action].title}}</v-list-tile-title>\n    </v-list-tile>\n   </template>\n  </v-list>\n </v-menu>\n</div>\n',props:["desktop",
"mini","nowplaying"],data:function(){return{items:[],currentIndex:-1,dialog:{show:!1,title:void 0,hint:void 0,ok:void 0,cancel:void 0},listSize:0,duration:0,playerStatus:{shuffle:0,repeat:0},trans:{ok:void 0,cancel:void 0,save:void 0,saveShortcut:void 0,clear:void 0,clearShortcut:void 0,repeatAll:void 0,repeatOne:void 0,repeatOff:void 0,shuffleAll:void 0,shuffleAlbums:void 0,shuffleOff:void 0,selectMultiple:void 0,remove:void 0,dstm:void 0},menu:{show:!1,item:void 0,x:0,y:0,index:0},selection:[],
settingsMenuActions:[PQ_MOVE_QUEUE_ACTION,PQ_SCROLL_ACTION,PQ_ADD_URL_ACTION],wide:0,dstm:!1}},computed:{darkUi:function(){return this.$store.state.darkUi},menuIcons:function(){return this.$store.state.menuIcons},threeLines:function(){return this.$store.state.queueThreeLines},keyboardControl:function(){return this.$store.state.keyboardControl&&!IS_MOBILE}},created:function(){this.fetchingItems=!1;this.timestamp=0;this.currentIndex=-1;this.items=[];this.autoScrollRequired=!1;this.previousScrollPos=
0},mounted:function(){var a=this;this.listSize=0;this.items=[];this.timestamp=0;bus.$on("playerChanged",function(){this.items=[];this.timestamp=0}.bind(this));bus.$on("queueDisplayChanged",function(){this.items=[];this.timestamp=0;this.updateItems()}.bind(this));bus.$on("playerStatus",function(a){a.playlist.shuffle!=this.playerStatus.shuffle&&(this.playerStatus.shuffle=a.playlist.shuffle);a.playlist.repeat!=this.playerStatus.repeat&&(this.playerStatus.repeat=a.playlist.repeat);a.playlist.count!=this.listSize&&
0==a.playlist.count&&0==a.playlist.timestamp&&(this.listSize=0,this.items=[],this.timestamp=0);this.playlistName=a.playlist.name;a.playlist.timestamp!=this.timestamp||0<a.playlist.timestamp&&1>this.items.length||0>=a.playlist.timestamp&&0<this.items.length||this.listSize!=a.playlist.count?(this.currentIndex=a.playlist.current,this.timestamp=a.playlist.timestamp,this.updateItems()):a.playlist.current!=this.currentIndex&&(this.currentIndex=a.playlist.current,this.$store.state.autoScrollQueue&&this.scrollToCurrent());
if(a.current){var b=a.current["playlist index"];if(void 0!=b&&0<=b&&b<this.items.length){a=a.current;var c=a.title;this.$store.state.queueShowTrackNum&&0<a.tracknum&&(c=(9<a.tracknum?a.tracknum:"0"+a.tracknum)+SEPARATOR+c);this.$store.state.ratingsSupport&&void 0!=a.rating&&(c=ratingString(c,a.rating));var d=buildSubtitle(a,this.$store.state.queueThreeLines);checkRemoteTitle(a);if(c!=this.items[b].title||d!=this.items[b].subtitle||a.duration!=this.items[b].duration)this.items[b].title=c,this.items[b].subtitle=
d,a.duration!=this.items[b].duration&&(this.items[b].durationStr=a.duration&&0<a.duration?formatSeconds(Math.floor(a.duration)):void 0,this.items[b].duration=a.duration,this.getDuration()),this.$forceUpdate()}}}.bind(this));this.coverTrackIndex=this.coverUrl=void 0;bus.$on("currentCover",function(a,b){this.coverUrl=void 0==a||a.endsWith(DEFAULT_COVER)?void 0:a;this.coverTrackIndex=b;this.setBgndCover()}.bind(this));bus.$emit("getCurrentCover");bus.$on("networkReconnected",function(){this.timestamp=
0;this.updateItems()}.bind(this));bus.$on("themeChanged",function(){this.setBgndCover()}.bind(this));bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems();bus.$on("esc",function(){this.menu.show=!1}.bind(this));this.scrollElement=document.getElementById("queue-list");this.scrollElement.addEventListener("scroll",function(){a.menu.show=!1;a.scrollAnimationFrameReq||(a.scrollAnimationFrameReq=window.requestAnimationFrame(a.handleScroll))});this.setBgndCover();this.$nextTick(function(){setScrollTop(this.scrollElement,
0);bus.$emit("refreshStatus");this.setBgndCover()});this.desktop||(bus.$on("pageChanged",function(a){"queue"==a&&this.$store.state.autoScrollQueue&&this.autoScrollRequired&&this.$nextTick(function(){this.scrollToCurrent()})}.bind(this)),bus.$on("nav",function(a,b){"queue"==a&&b&&this.scrollToCurrent(!0)}.bind(this)),bus.$on("settingsMenuAction:queue",function(a){this.headerAction(a)}.bind(this)),bus.$on("windowWidthChanged",function(){var a=520<=window.innerWidth?2:340<=window.innerWidth?1:0;a!=this.wide&&
(this.wide=a,bus.$emit("settingsMenuActions",1<this.wide?[]:this.settingsMenuActions,"queue"))}.bind(this)),this.wide=520<=window.innerWidth?2:340<=window.innerWidth?1:0,bus.$emit("settingsMenuActions",1<this.wide?[]:this.settingsMenuActions,"queue"));bus.$on("noPlayers",function(){this.updateSettingsMenu()}.bind(this));bus.$on("playerListChanged",function(){this.updateSettingsMenu()}.bind(this));bus.$on("prefset",function(a,b){"plugin.dontstopthemusic:provider"==a&&(this.dstm="0"!=""+b)}.bind(this));
this.updateSettingsMenu();IS_MOBILE||(bindKey(LMS_SAVE_QUEUE_KEYBOARD,"mod"),bindKey(LMS_CLEAR_QUEUE_KEYBOARD,"mod"),bindKey(LMS_QUEUE_ADD_URL_KEYBOARD,"mod"),bindKey(LMS_SCROLL_QUEUE_KEYBOARD,"mod"),bindKey(LMS_MOVE_QUEUE_KEYBOARD,"mod"),bus.$on("keyboard",function(a,b){!this.$store.state.keyboardControl||"mod"!=b||!this.desktop&&"queue"!=this.$store.state.page||0<this.$store.state.openDialogs.length||(LMS_SAVE_QUEUE_KEYBOARD==a?0<this.$store.state.visibleMenus.size||this.save():LMS_CLEAR_QUEUE_KEYBOARD==
a?0<this.$store.state.visibleMenus.size||this.clear():LMS_QUEUE_ADD_URL_KEYBOARD!=a&&LMS_SCROLL_QUEUE_KEYBOARD!=a&&LMS_MOVE_QUEUE_KEYBOARD!=a||1<this.$store.state.visibleMenus.size||1>=this.wide&&1==this.$store.state.visibleMenus&&!this.$store.state.visibleMenus.has("main")||(this.headerAction(LMS_QUEUE_ADD_URL_KEYBOARD==a?PQ_ADD_URL_ACTION:LMS_SCROLL_QUEUE_KEYBOARD==a?PQ_SCROLL_ACTION:PQ_MOVE_QUEUE_ACTION),bus.$emit("hideMenu","main")))}.bind(this)))},methods:{initItems:function(){this.trans={ok:i18n("OK"),
cancel:i18n("Cancel"),save:i18n("Save queue"),saveShortcut:i18n("Ctrl(\u2318)+%1",LMS_SAVE_QUEUE_KEYBOARD),clear:i18n("Clear queue"),clearShortcut:i18n("Ctrl(\u2318)+%1",LMS_CLEAR_QUEUE_KEYBOARD),repeatAll:i18n("Repeat queue"),repeatOne:i18n("Repeat single track"),repeatOff:i18n("No repeat"),shuffleAll:i18n("Shuffle tracks"),shuffleAlbums:i18n("Shuffle albums"),shuffleOff:i18n("No shuffle"),selectMultiple:i18n("Select multiple items"),remove:PQ_REMOVE_ACTION.title,dstm:i18n("Don't Stop The Music")}},
handleScroll:function(){this.scrollAnimationFrameReq=void 0;if(!(this.fetchingItems||this.listSize<=this.items.length)){var a=this.scrollElement.clientHeight,c=this.scrollElement.scrollHeight,b=2.5*a;(a+this.scrollElement.scrollTop>=c-(c>b?b:300)||c<a)&&this.fetchItems()}},save:function(){if(1>this.items.length)bus.$emit("showMessage",i18n("Queue is empty"));else{var a=""+(void 0==this.playlistName?"":this.playlistName);this.dialog={show:!0,title:i18n("Save play queue"),hint:i18n("Name"),ok:i18n("Save"),
value:a,action:"save"}}},clear:function(){1>this.items.length||this.$confirm(i18n("Remove all tracks from queue?"),{buttonTrueText:i18n("Clear"),buttonFalseText:i18n("Cancel")}).then(function(a){a&&bus.$emit("playerCommand",["playlist","clear"])})},dialogResponse:function(a){if(a&&this.dialog.value){var c=this.dialog.value.trim();1<c.length&&(this.dialog.show=!1,"add"==this.dialog.action?lmsCommand(this.$store.state.player.id,["playlist",0==this.items.length?"play":"add",c]).then(function(a){bus.$emit("refreshStatus")}):
lmsCommand(this.$store.state.player.id,["playlist","save",c]).then(function(a){bus.$emit("refreshPlaylist",c)}).catch(function(a){bus.$emit("showError",a,i18n("Failed to save play queue!"));logError(a)}))}},click:function(a,c,b){0<this.selection.length?this.select(a,c):this.menu.show?this.menu.show=!1:0<this.$store.state.visibleMenus.size||(this.clickTimer?(clearTimeout(this.clickTimer),this.clickTimer=void 0,this.doubleClick(a,c,b)):this.clickTimer=setTimeout(function(){this.clickTimer=void 0;this.singleClick(a,
c,b)}.bind(this),LMS_DOUBLE_CLICK_TIMEOUT))},singleClick:function(a,c,b){this.$store.state.showMenuAudioQueue&&(!lastQueueItemClick||500<new Date-lastQueueItemClick)&&(lastQueueItemClick=void 0,this.itemMenu(a,c,b))},doubleClick:function(a,c,b){this.itemAction(PQ_PLAY_NOW_ACTION,a,c)},itemAction:function(a,c,b){PQ_PLAY_NOW_ACTION===a?bus.$emit("playerCommand",["playlist","index",b]):PQ_PLAY_NEXT_ACTION===a?b!==this.currentIndex&&bus.$emit("playerCommand",["playlist","move",b,b>this.currentIndex?this.currentIndex+
1:this.currentIndex]):PQ_REMOVE_ACTION===a?bus.$emit("playerCommand",["playlist","delete",b]):PQ_MORE_ACTION===a?(bus.$emit("trackInfo",c,b,"queue"),this.desktop||this.$store.commit("setPage","browse")):PQ_SELECT_ACTION===a?(a=this.selection.indexOf(b),0>a&&(this.selection.push(b),c.selected=!0,a=c.actions.indexOf(PQ_SELECT_ACTION),-1<a&&(c.actions[a]=PQ_UNSELECT_ACTION),this.items.length>LMS_MAX_NON_SCROLLER_ITEMS&&forceItemUpdate(this,c))):PQ_UNSELECT_ACTION===a&&(a=this.selection.indexOf(b),-1<
a&&(this.selection.splice(a,1),c.selected=!1,a=c.actions.indexOf(PQ_UNSELECT_ACTION),-1<a&&(c.actions[a]=PQ_SELECT_ACTION),this.items.length>LMS_MAX_NON_SCROLLER_ITEMS&&forceItemUpdate(this,c)))},headerAction:function(a){0<this.$store.state.visibleMenus.size&&(this.desktop||0>this.settingsMenuActions.indexOf(a))||(a==PQ_ADD_URL_ACTION?this.dialog={show:!0,title:i18n("Add a URL to play queue"),hint:i18n("URL"),ok:i18n("Add"),value:"http://",action:"add"}:a==PQ_SCROLL_ACTION?1>this.items.length?bus.$emit("showMessage",
i18n("Nothing playing")):this.scrollToCurrent(!0):a!=PQ_MOVE_QUEUE_ACTION||!this.$store.state.player||!this.$store.state.players||2>this.$store.state.players.length||(1>this.items.length?bus.$emit("showMessage",i18n("Queue is empty")):bus.$emit("dlg.open","movequeue",this.$store.state.player)))},itemMenu:function(a,c,b){showMenu(this,{show:!0,item:a,index:c,x:b.clientX,y:b.clientY})},removeSelectedItems:function(){this.selection.sort(function(a,c){return a<c?1:-1});bus.$emit("removeFromQueue",this.selection);
this.clearSelection()},clearSelection:function(){for(var a=0,c=this.selection.length;a<c;++a){var b=this.selection[a];if(-1<b&&b<this.items.length){var e=this.items[b].actions.indexOf(PQ_UNSELECT_ACTION);-1<e&&(this.items[b].actions[e]=PQ_SELECT_ACTION);this.items[b].selected=!1}}0<this.selection.length&&this.items.length>LMS_MAX_NON_SCROLLER_ITEMS&&this.$nextTick(function(){this.items=JSON.parse(JSON.stringify(this.items))});this.selection=[]},select:function(a,c){0<this.selection.length&&this.itemAction(0>
this.selection.indexOf(c)?PQ_SELECT_ACTION:PQ_UNSELECT_ACTION,a,c)},getDuration:function(){var a=this;if(0<this.items.length)if(this.items.length==this.listSize){for(var c=0,b=0;b<this.listSize;++b)void 0!=this.items[b].duration&&0<this.items[b].duration&&(c+=this.items[b].duration);this.duration=c;bus.$emit("queueStatus",this.listSize,this.duration)}else lmsCommand(this.$store.state.player.id,["status","-",1,"tags:DD"]).then(function(b){b=b.data;a.duration=b.result&&b.result["playlist duration"]?
parseFloat(b.result["playlist duration"]):0;bus.$emit("queueStatus",a.listSize,a.duration)});else this.duration=0,bus.$emit("queueStatus",this.listSize,this.duration)},checkCover:function(){if(void 0!=this.currentIndex&&0<=this.currentIndex&&this.currentIndex<this.items.length){var a=changeImageSizing(this.items[this.currentIndex].image);if(a){var c=changeImageSizing(this.coverUrl);a!=c&&bus.$emit("refreshStatus")}}},fetchItems:function(){var a=this;if(this.$store.state.player){this.fetchingItems=
!0;var c=this.timestamp;lmsList(this.$store.state.player.id,["status"],[PQ_STATUS_TAGS+(!IS_MOBILE&&this.$store.state.ratingsSupport?"R":"")],this.items.length,this.currentIndex>this.items.length+LMS_QUEUE_BATCH_SIZE?this.currentIndex+50:LMS_QUEUE_BATCH_SIZE).then(function(b){b=parseResp(b.data,a.$store.state.queueShowTrackNum,a.items.length,a.desktop&&a.$store.state.ratingsSupport,a.$store.state.queueThreeLines,a.$store.state.infoPlugin);a.items.push.apply(a.items,b.items);var e=a.timestamp!==c&&
a.timestamp!==b.timestamp;a.timestamp=b.timestamp;a.fetchingItems=!1;a.listSize=b.size;a.checkCover();a.getDuration();e?a.$nextTick(function(){this.updateItems()}):a.$store.state.autoScrollQueue&&a.$nextTick(function(){this.scrollToCurrent()})}).catch(function(b){a.fetchingItems=!1;logError(b)})}},updateItems:function(){var a=this;if(!this.fetchingItems)if(0===this.items.length)this.fetchItems();else{var c=this.scrollElement.scrollTop,b=this.currentIndex;this.fetchingItems=!0;var e=this.timestamp;
lmsList(this.$store.state.player.id,["status"],[PQ_STATUS_TAGS+(!IS_MOBILE&&this.$store.state.ratingsSupport?"R":"")],0,this.items.length<LMS_QUEUE_BATCH_SIZE?LMS_QUEUE_BATCH_SIZE:this.items.length).then(function(d){var g=parseResp(d.data,a.$store.state.queueShowTrackNum,0,a.desktop&&a.$store.state.ratingsSupport,a.$store.state.queueThreeLines,a.$store.state.infoPlugin);a.items=g.items;d=a.timestamp!==e&&a.timestamp!==g.timestamp;a.timestamp=g.timestamp;a.fetchingItems=!1;a.listSize=g.size;a.checkCover();
a.getDuration();if(0<a.selection.length){g=[];for(var f=0,k=a.selection.length;f<k;++f)a.selection[f]<a.items.length&&(g.push(a.selection[f]),a.items[a.selection[f]].selected=!0);a.selection=g}a.$nextTick(function(){setScrollTop(this.scrollElement,0<c?c:0)});d?a.$nextTick(function(){this.updateItems()}):(b!=a.currentIndex||a.autoScrollRequired)&&a.$store.state.autoScrollQueue&&a.$nextTick(function(){this.scrollToCurrent()})}).catch(function(b){a.fetchingItems=!1;logError(b)})}},scrollToCurrent:function(a){if(this.desktop||
"queue"==this.$store.state.page){this.autoScrollRequired=!1;var c=5<this.items.length&&0<=this.currentIndex;if(c||a&&0<this.items.length)if(this.currentIndex<this.items.length)if(this.items.length<=LMS_MAX_NON_SCROLLER_ITEMS){var b=document.getElementById("track"+this.currentIndex);b&&(c&&setScrollTop(this.scrollElement,(3<this.currentIndex?this.currentIndex-3:0)*(b.clientHeight+1)),a&&animate(b,1,.2))}else{if(c){var e=3<this.currentIndex?(this.currentIndex-3)*(this.$store.state.queueThreeLines?LMS_LIST_3LINE_ELEMENT_SIZE:
LMS_LIST_ELEMENT_SIZE):0;setScrollTop(this.scrollElement,0<e?e:0);setTimeout(function(){setScrollTop(this.scrollElement,0<e?e:0)}.bind(this),100)}}else c&&(this.autoScrollRequired=!0,this.fetchItems())}else this.autoScrollRequired=!0},dragStart:function(a,c){c.dataTransfer.dropEffect="move";c.dataTransfer.setData("Text",this.id);this.dragIndex=a;this.stopScrolling=!1;0<this.selection.length&&0>this.selection.indexOf(a)&&this.clearSelection()},dragEnd:function(){this.stopScrolling=!0;this.dragIndex=
void 0},dragOver:function(a){this.stopScrolling=!0;110>a.clientY&&(this.stopScrolling=!1,this.scrollList(-5));a.clientY>window.innerHeight-70&&(this.stopScrolling=!1,this.scrollList(5));a.preventDefault()},scrollList:function(a){var c=this.scrollElement.scrollTop+a;setScrollTop(this.scrollElement,c);if(0>=c||c>=this.scrollElement.scrollTopMax)this.stopScrolling=!0;this.stopScrolling||setTimeout(function(){this.scrollList(a)}.bind(this),100)},drop:function(a,c){this.stopScrolling=!0;c.preventDefault();
void 0!=this.dragIndex&&a!=this.dragIndex&&(0<this.selection.length?0>this.selection.indexOf(a)&&bus.$emit("moveQueueItems",this.selection.sort(function(a,c){return a<c?-1:1}),a):bus.$emit("playerCommand",["playlist","move",this.dragIndex,a]),this.clearSelection());this.dragIndex=void 0},i18n:function(a){return i18n(a)},setBgndCover:function(){setBgndCover(this.scrollElement,this.$store.state.queueBackdrop?this.coverUrl:void 0,this.$store.state.darkUi);if(this.coverUrl&&void 0!=this.coverTrackIndex&&
0<=this.coverTrackIndex&&this.coverTrackIndex<this.items.length){var a=changeImageSizing(this.coverUrl,LMS_IMAGE_SIZE);this.items[this.coverTrackIndex].image!=a&&(this.items[this.coverTrackIndex].key=this.items[this.coverTrackIndex].id+"."+this.coverTrackIndex+"."+(new Date).getTime().toString(16),this.items[this.coverTrackIndex].image=a,this.$forceUpdate())}},updateSettingsMenu:function(){var a=this.$store.state.players&&1<this.$store.state.players.length;a&&this.settingsMenuActions[0]!=PQ_MOVE_QUEUE_ACTION?
(this.settingsMenuActions.unshift(PQ_MOVE_QUEUE_ACTION),bus.$emit("settingsMenuActions",1<this.wide?[]:this.settingsMenuActions,"queue")):a||this.settingsMenuActions[0]!=PQ_MOVE_QUEUE_ACTION||(this.settingsMenuActions.splice(0,1),bus.$emit("settingsMenuActions",1<this.wide?[]:this.settingsMenuActions,"queue"))},repeatOff:function(a){a?bus.$emit("dlg.open","dstm"):bus.$emit("playerCommand",["playlist","repeat",2])}},filters:{displayTime:function(a,c){return a?c?1E-12>a?"":" ("+formatSeconds(Math.floor(a))+
")":formatSeconds(Math.floor(a)):""},displayCount:function(a){return a?i18np("1 Track","%1 Tracks",a):""},displaySelectionCount:function(a){return a?i18np("1 Selected Item","%1 Selected Items",a):""},svgIcon:function(a,c){return"/material/svg/"+a+"?c="+(c?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION},tooltip:function(a,c,b){return b?a+SEPARATOR+c:a}},watch:{"menu.show":function(a){this.$store.commit("menuVisible",{name:"queue",shown:a})}},beforeDestroy:function(){void 0!==this.updateTimer&&
(clearTimeout(this.updateTimer),this.updateTimer=void 0)}});
