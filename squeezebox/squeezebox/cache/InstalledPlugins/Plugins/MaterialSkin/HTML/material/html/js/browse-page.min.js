var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,e,d){return c==a&&"q"==e&&d==b}}));return!0===b.q}catch(c){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),e=new a([[b,2],[c,3]]);if(2!=e.get(b)||3!=e.get(c))return!1;e.delete(b);e.set(c,4);return!e.has(b)&&4==e.get(c)}catch(h){return!1}}function c(){}function e(a){if(!$jscomp.owns(a,g)){var b=new c;$jscomp.defineProperty(a,g,{value:b})}}function d(a){var b=Object[a];b&&(Object[a]=function(a){if(a instanceof c)return a;e(a);return b(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&
$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var g="$jscomp_hidden_"+Math.random();d("freeze");d("preventExtensions");d("seal");var f=0,k=function(a){this.id_=(f+=Math.random()+1).toString();if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};k.prototype.set=function(a,b){e(a);if(!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+a);a[g][this.id_]=b;return this};k.prototype.get=function(a){return $jscomp.owns(a,g)?a[g][this.id_]:void 0};k.prototype.has=
function(a){return $jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)};k.prototype.delete=function(a){return $jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)?delete a[g][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var e=c.entries(),d=e.next();if(d.done||d.value[0]!=b||"s"!=d.value[1])return!1;d=e.next();return d.done||4!=d.value[0].x||"t"!=d.value[1]||!e.next().done?!1:!0}catch(n){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=new WeakMap,e=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};e.prototype.set=function(a,b){a=0===a?0:a;var c=d(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,
value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};e.prototype.delete=function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};e.prototype.has=function(a){return!!d(this,a).entry};
e.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};e.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return g(this,function(a){return a.key})};e.prototype.values=function(){return g(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var c=this.entries(),e;!(e=c.next()).done;)e=e.value,a.call(b,e[1],e[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var d=function(a,b){var e=b&&typeof b;"object"==
e||"function"==e?c.has(b)?e=c.get(b):(e=""+ ++k,c.set(b,e)):e="p_"+b;var d=a.data_[e];if(d&&$jscomp.owns(a.data_,e))for(a=0;a<d.length;a++){var g=d[a];if(b!==b&&g.key!==g.key||b===g.key)return{id:e,list:d,index:a,entry:g}}return{id:e,list:d,index:-1,entry:void 0}},g=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=
a.next=a.head=a},k=0;return e},"es6","es3");
$jscomp.polyfill("Set",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([b]));if(!c.has(b)||1!=c.size||c.add(b)!=c||1!=c.size||c.add({x:4})!=c||2!=c.size)return!1;var g=c.entries(),f=g.next();if(f.done||f.value[0]!=b||f.value[1]!=b)return!1;f=g.next();return f.done||f.value[0]==b||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:g.next().done}catch(k){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;$jscomp.initSymbolIterator();var c=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};c.prototype.add=function(a){a=0===a?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};c.prototype.delete=function(a){a=this.map_.delete(a);this.size=this.map_.size;return a};c.prototype.clear=function(){this.map_.clear();
this.size=0};c.prototype.has=function(a){return this.map_.has(a)};c.prototype.entries=function(){return this.map_.entries()};c.prototype.values=function(){return this.map_.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(e){return a.call(b,e,e,c)})};return c},"es6","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var d=b.length,g=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var f=0;f<g&&c<d;)if(b[c++]!=a[f++])return!1;return f>=g}},"es6","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var d=a.length;0<d&&0<c;)if(b[--c]!=a[--d])return!1;return 0>=d}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,e){c=null!=c?c:function(a){return a};var b=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof g){a=g.call(a);for(var f=0;!(g=a.next()).done;)b.push(c.call(e,g.value,f++))}else for(g=a.length,f=0;f<g;f++)b.push(c.call(e,a[f],f));return b}},"es6","es3");
var B_ALBUM_SORTS=[],lmsBrowse=Vue.component("lms-browse",{template:'\n<div id="browse-view">\n <v-dialog v-model="dialog.show" persistent max-width="500px">\n  <v-card>\n   <v-card-title>{{dialog.title}}</v-card-title>\n   <v-card-text>\n    <v-text-field single-line v-if="dialog.show" :label="dialog.hint" v-model="dialog.value" autofocus @keyup.enter="dialogResponse(true);"></v-text-field>\n   </v-card-text>\n  <v-card-actions>\n   <v-spacer></v-spacer>\n   <v-btn flat @click.native="dialog.show = false; dialogResponse(false);">{{undefined===dialog.cancel ? trans.cancel : dialog.cancel}}</v-btn>\n   <v-btn flat @click.native="dialogResponse(true);">{{undefined===dialog.ok ? trans.ok : dialog.ok}}</v-btn>\n  </v-card-actions>\n  </v-card>\n </v-dialog>\n <div v-if="headerTitle" class="subtoolbar noselect" v-bind:class="{\'list-details\' : selection.length>0}">\n  <v-layout v-if="selection.length>0">\n   <v-layout row wrap>\n    <v-flex xs12 class="ellipsis subtoolbar-title subtoolbar-pad">{{trans.selectMultiple}}</v-flex>\n    <v-flex xs12 class="ellipsis subtoolbar-subtitle subtext">{{selection.length | displaySelectionCount}}</v-flex>\n   </v-layout>\n   <v-spacer></v-spacer>\n   <v-btn v-if="current && current.section==SECTION_PLAYLISTS && current.id.startsWith(\'playlist_id:\')" :title="trans.removeall" flat icon class="toolbar-button" @click="deleteSelectedItems(REMOVE_ACTION)"><v-icon>{{ACTIONS[REMOVE_ACTION].icon}}</v-icon></v-btn>\n   <v-btn v-else-if="current && current.section==SECTION_PLAYLISTS" :title="trans.deleteall" flat icon class="toolbar-button" @click="deleteSelectedItems(DELETE_ACTION)"><v-icon>delete</v-icon></v-btn>\n   <v-btn v-else-if="current && current.section==SECTION_FAVORITES" :title="trans.removeall" flat icon class="toolbar-button" @click="deleteSelectedItems(REMOVE_FROM_FAV_ACTION)"><v-icon>delete_outline</v-icon></v-btn>\n   <v-divider vertical v-if="current && (current.section==SECTION_PLAYLISTS || current.section==SECTION_FAVORITES)"></v-divider>\n   <v-btn :title="trans.addall" flat icon class="toolbar-button" @click="addSelectedItems()"><v-icon>add_circle_outline</v-icon></v-btn>\n   <v-btn :title="trans.playall" flat icon class="toolbar-button" @click="playSelectedItems()"><v-icon>play_circle_outline</v-icon></v-btn>\n   <v-divider vertical></v-divider>\n   <v-btn :title="trans.cancel" flat icon class="toolbar-button" @click="clearSelection()"><v-icon>cancel</v-icon></v-btn>\n  </v-layout>\n  <v-layout v-else>\n   <v-btn flat icon @click="homeBtnPressed()" class="toolbar-button" id="home-button"><v-icon>home</v-icon></v-btn>\n   <v-btn flat icon v-longpress="backBtnPressed" class="toolbar-button" id="back-button"><v-icon>arrow_back</v-icon></v-btn>\n   <v-layout row wrap @click="showHistory($event)" v-if="headerSubTitle" v-bind:class="{pointer : history.length>1}">\n    <v-flex xs12 class="ellipsis subtoolbar-title subtoolbar-pad">{{headerTitle}}</v-flex>\n    <v-flex xs12 class="ellipsis subtoolbar-subtitle subtext">{{current && current.id==TOP_MYMUSIC_ID && libraryName ? libraryName : headerSubTitle}}</v-flex>\n   </v-layout>\n   <div class="ellipsis subtoolbar-title subtoolbar-title-single pointer" @click="showHistory($event)" v-else-if="history.length>1">{{headerTitle}}</div>\n   <div class="ellipsis subtoolbar-title subtoolbar-title-single" v-else>{{headerTitle}}</div>\n   <v-spacer style="flex-grow: 10!important"></v-spacer>\n   <v-btn flat icon v-if="showRatingButton && items.length>1" @click.stop="setAlbumRating()" class="toolbar-button" :title="trans.albumRating"><v-icon>stars</v-icon></v-btn>\n   <template v-if="desktop" v-for="(action, index) in settingsMenuActions">\n    <v-btn flat icon @click.stop="headerAction(action, $event)" class="toolbar-button" :title="ACTIONS[action].title" :id="\'tbar\'+index">\n      <img v-if="ACTIONS[action].svg" class="svg-img" :src="ACTIONS[action].svg | svgIcon(darkUi)"></img>\n      <v-icon v-else>{{ACTIONS[action].icon}}</v-icon>\n    </v-btn>\n   </template>\n   <v-divider vertical v-if="tbarActions.length>0 && ((showRatingButton && items.length>1) || (desktop && settingsMenuActions && settingsMenuActions.length>0))"></v-divider>\n   <template v-for="(action, index) in tbarActions">\n    <v-btn flat icon @click.stop="headerAction(action, $event)" class="toolbar-button" :title="action | tooltip(keyboardControl)" :id="\'tbar\'+index" v-if="action!=VLIB_ACTION || libraryName">\n      <img v-if="ACTIONS[action].svg" class="svg-img" :src="ACTIONS[action].svg | svgIcon(darkUi)"></img>\n      <v-icon v-else>{{ACTIONS[action].icon}}</v-icon>\n    </v-btn>\n   </template>\n  </v-layout>\n </div>\n <v-progress-circular class="browse-progress" v-if="fetchingItems" color="primary" size=72 width=6 indeterminate></v-progress-circular>\n <div v-show="letter" id="letterOverlay"></div>\n\n <div v-if="grid.use">\n  <div class="noselect bgnd-cover lms-jumplist" v-bind:class="{\'lms-jumplist-wide\':jumplistWide}" v-if="filteredJumplist.length>1">\n   <template v-for="(item, index) in filteredJumplist">\n    <div @click="jumpTo(item)" v-bind:class="{\'active-btn\' : jumplistActive==index}">{{item.key==\' \' || item.key==\'\' ? \'?\' : item.key}}</div>\n   </template>\n  </div>\n  <div class="lms-image-grid noselect bgnd-cover" id="browse-grid" style="overflow:auto;" v-bind:class="{\'lms-image-grid-jump\': filteredJumplist.length>1}">\n  <RecycleScroller :items="grid.rows" :item-size="GRID_SIZES[grid.size].ih - (grid.haveSubtitle ? 0 : GRID_SINGLE_LINE_DIFF)" page-mode key-field="id">\n   <table slot-scope="{item, index}" :class="[grid.few ? \'\' : \'full-width\', GRID_SIZES[grid.size].clz]">\n    <td align="center" style="vertical-align: top" v-for="(idx, cidx) in item.indexes"><v-card flat align="left" class="image-grid-item">\n     <div v-if="idx>=items.length" class="image-grid-item"></div>\n     <div v-else class="image-grid-item" v-bind:class="{\'image-grid-item-few\': grid.few}" @click="click(items[idx], idx, $event)" :title="items[idx] | itemTooltip">\n      <v-btn icon color="primary" v-if="selection.length>0" class="image-grid-select-btn" @click.stop="select(items[idx], idx)">\n       <v-icon>{{items[idx].selected ? \'check_box\' : \'check_box_outline_blank\'}}</v-icon>\n      </v-btn>\n      <img :key="items[idx].image" :src="items[idx].image" v-bind:class="{\'radio-img\': SECTION_RADIO==items[idx].section}" class="image-grid-item-img"></img>\n      <div class="image-grid-text">{{items[idx].title}}</div>\n      <div class="image-grid-text subtext" v-bind:class="{\'clickable\':subtitleClickable}" @click.stop="clickSubtitle(items[idx], idx, $event)">{{items[idx].subtitle}}</div>\n      <v-btn flat icon v-else-if="items[idx].menu && items[idx].menu.length>0" @click.stop="itemMenu(items[idx], idx, $event)" class="image-grid-btn">\n       <v-icon>more_vert</v-icon>\n      </v-btn>\n     </div>\n    </v-card></td>\n   </table>\n  </RecycleScroller>\n </div></div>\n <div v-else>\n\n <div class="noselect bgnd-cover lms-jumplist" v-bind:class="{\'lms-jumplist-wide\':jumplistWide}" v-if="filteredJumplist.length>1">\n  <template v-for="(item, index) in filteredJumplist">\n   <div @click="jumpTo(item)" v-bind:class="{\'active-btn\' : jumplistActive==index}">{{item.key==\' \' || item.key==\'\' ? \'?\' : item.key}}</div>\n  </template>\n </div>\n\n <v-list class="bgnd-cover" v-bind:class="{\'lms-list\': !headerTitle, \'lms-list-sub\': headerTitle, \'lms-list-jump\': filteredJumplist.length>1}" id="browse-list">\n  <RecycleScroller v-if="!isTop && ((grid.allowed && current.id!=TOP_RADIO_ID && current.id!=TOP_APPS_ID) || items.length>LMS_MAX_NON_SCROLLER_ITEMS)" :items="items" :item-size="LMS_LIST_ELEMENT_SIZE" page-mode key-field="id">\n   <v-list-tile avatar @click="click(item, index, $event)" slot-scope="{item, index}" @dragstart="dragStart(index, $event)" @dragend="dragEnd()" @dragover="dragOver($event)" @drop="drop(index, $event)" :draggable="item.draggable && (current.section!=SECTION_FAVORITES || 0==selection.length)">\n    <v-list-tile-avatar v-if="item.selected" :tile="true" class="lms-avatar">\n     <v-icon>check_box</v-icon>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="item.image" :tile="true" v-bind:class="{\'radio-image\': SECTION_RADIO==item.section}" class="lms-avatar">\n     <img :key="item.image" :src="item.image"></img>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="item.icon" :tile="true" class="lms-avatar">\n     <v-icon>{{item.icon}}</v-icon>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="item.svg" :tile="true" class="lms-avatar">\n      <img class="svg-list-img" :src="item.svg | svgIcon(darkUi)"></img>\n    </v-list-tile-avatar>\n\n    \x3c!-- TODO: Do we have search fields with large lists?? --\x3e\n    <v-list-tile-content v-if="item.header" @click="click(item, index, $event)"><v-list-tile-title class="browse-header">{{item.title}}</v-list-tile-title></v-list-tile-content>\n    <v-list-tile-content v-else>\n     <v-list-tile-title>{{item.title}}</v-list-tile-title>\n      <v-list-tile-sub-title v-html="item.subtitle" v-bind:class="{\'clickable\':subtitleClickable}" @click.stop="clickSubtitle(item, index, $event, $event)"></v-list-tile-sub-title>\n    </v-list-tile-content>\n\n    <v-list-tile-action class="browse-action" v-if="item.menu && item.menu.length>0">\n     <v-btn icon @click.stop="itemMenu(item, index, $event)">\n      <v-icon>more_vert</v-icon>\n     </v-btn>\n    </v-list-tile-action>\n   </v-list-tile>\n  </RecycleScroller>\n\n  <template v-else v-for="(item, index) in items">\n   <v-list-tile v-if="item.type==\'text\' && canClickText(item)" avatar @click="click(item, index, $event)" v-bind:class="{\'error-text\': item.id===\'error\'}" class="lms-avatar lms-list-item">\n    <v-list-tile-content>\n     <v-list-tile-title>{{item.title}}</v-list-tile-title>\n     <v-list-tile-sub-title v-html="item.subtitle"></v-list-tile-sub-title>\n    </v-list-tile-content>\n   </v-list-tile>\n   <v-list-tile v-else-if="item.type==\'html\'" class="lms-list-item browse-text" v-html="item.title"></v-list-tile>\n   <v-list-tile v-else-if="item.type==\'text\'" class="lms-list-item browse-text">{{item.title}}</v-list-tile>\n   <v-list-tile v-else-if="item.header" class="lms-list-item" @click="click(item, index, $event)"><v-list-tile-content><v-list-tile-title class="browse-header">{{item.title}}</v-list-tile-title></v-list-tile-content>\n    <v-list-tile-action class="browse-action" v-if="item.menu && item.menu.length>0">\n     <v-btn icon @click.stop="itemMenu(item, index, $event)">\n      <v-icon>more_vert</v-icon>\n     </v-btn>\n    </v-list-tile-action>\n   </v-list-tile>\n   <v-list-tile v-else-if="!(isTop && (disabled.has(item.id) || hidden.has(item.id)))" avatar @click="click(item, index, $event)" :key="item.id" class="lms-avatar lms-list-item" :id="\'item\'+index" @dragstart="dragStart(index, $event)" @dragend="dragEnd()" @dragover="dragOver($event)" @drop="drop(index, $event)" :draggable="(isTop && !sortHome) || (item.draggable && (current.section!=SECTION_FAVORITES || 0==selection.length))">\n    <v-list-tile-avatar v-if="item.selected" :tile="true" class="lms-avatar">\n     <v-icon>check_box</v-icon>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="item.image" :tile="true" v-bind:class="{\'radio-image\': SECTION_RADIO==item.section, \'lms-avatar-small\': isTop || (current && (current.id==TOP_RADIO_ID || current.id==TOP_APPS_ID)), \'lms-avatar\': current && current.id!=TOP_RADIO_ID && current.id!=TOP_APPS_ID}">\n     <img :key="item.image" v-lazy="item.image"></img>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="item.icon" :tile="true" class="lms-avatar">\n     <v-icon>{{item.icon}}</v-icon>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="item.svg" :tile="true" class="lms-avatar">\n      <img class="svg-list-img" :src="item.svg | svgIcon(darkUi)"></img>\n    </v-list-tile-avatar>\n    <v-list-tile-avatar v-else-if="selection.length>0" :tile="true" class="lms-avatar">\n     <v-icon>check_box_outline_blank</v-icon>\n    </v-list-tile-avatar>\n\n    <v-list-tile-content v-if="item.type==\'search\'">\n     <v-text-field single-line clearable class="lms-search" :label="item.title" v-on:keyup.enter="search($event, item)"></v-text-field>\n    </v-list-tile-content>\n\n    <v-list-tile-content v-else-if="item.type==\'entry\'">\n     <v-text-field single-line clearable class="lms-search" :label="item.title" v-on:keyup.enter="entry($event, item)"></v-text-field>\n    </v-list-tile-content>\n\n    <v-list-tile-content v-else>\n     <v-list-tile-title>{{item.title}}</v-list-tile-title>\n     <v-list-tile-sub-title v-html="item.subtitle" v-bind:class="{\'clickable\':subtitleClickable}" @click.stop="clickSubtitle(item, index, $event)"></v-list-tile-sub-title>\n    </v-list-tile-content>\n\n    <v-list-tile-action class="browse-action" v-if="item.menu && item.menu.length>0">\n     <v-btn flat icon v-if="item.menu.length==1 && item.menu[0]==SEARCH_LIB_ACTION" @click.stop="itemAction(item.menu[0], item, index)">\n      <img v-if="ACTIONS[item.menu[0]].svg" :src="ACTIONS[item.menu[0]].svg | svgIcon(darkUi)"></img>\n      <v-icon v-else>{{ACTIONS[item.menu[0]].icon}}</v-icon>\n     </v-btn>\n     <v-btn icon v-else @click.stop="itemMenu(item, index, $event)">\n      <v-icon>more_vert</v-icon>\n     </v-btn>\n    </v-list-tile-action>\n\n   </v-list-tile>\n  </template>\n\n  <v-list-tile class="lms-list-pad"></v-list-tile>\n </v-list>\n </div>\n\n <v-menu v-model="menu.show" :position-x="menu.x" :position-y="menu.y">\n  <v-list v-if="menu.presets">\n   <v-list-tile><v-list-tile-title><b>{{trans.choosepos}}</b></v-list-tile-title></v-list-tile>\n   <v-divider></v-divider>\n   <template v-for="(p, index) in menu.presets">\n    <v-list-tile @click="savePreset(menu.item, p)">\n     <v-list-tile-content><v-list-tile-title>{{p}}</v-list-tile-title></v-list-tile-content>\n    </v-list-tile>\n   </template>\n   <v-divider></v-divider>\n   <v-list-tile @click="menu.show = false">\n     <v-list-tile-content><v-list-tile-title>{{trans.cancel}}</v-list-tile-title></v-list-tile-content>\n    </v-list-tile>\n  </v-list>\n  <v-list v-else-if="menu.item && menu.item.moremenu">\n   <template v-for="(entry, index) in menu.item.moremenu">\n    <v-list-tile @click="itemMoreAction(menu.item, index)">\n     <v-list-tile-title>{{entry.title}}</v-list-tile-title>\n    </v-list-tile>\n   </template>\n  </v-list>\n  <v-list v-else-if="menu.item">\n   <template v-for="(action, index) in menu.item.menu">\n    <v-divider v-if="DIVIDER==action"></v-divider>\n    <v-list-tile v-else-if="action==ADD_TO_FAV_ACTION && isInFavorites(menu.item)" @click="itemAction(REMOVE_FROM_FAV_ACTION, menu.item, menu.index)">\n     <v-list-tile-avatar v-if="menuIcons">\n      <v-icon v-if="undefined==ACTIONS[REMOVE_FROM_FAV_ACTION].svg">{{ACTIONS[REMOVE_FROM_FAV_ACTION].icon}}</v-icon>\n      <img v-else class="svg-img" :src="ACTIONS[REMOVE_FROM_FAV_ACTION].svg | svgIcon(darkUi)"></img>\n     </v-list-tile-avatar>\n     <v-list-tile-title>{{ACTIONS[REMOVE_FROM_FAV_ACTION].title}}</v-list-tile-title>\n    </v-list-tile>\n    <v-list-tile v-else @click="itemAction(action, menu.item, menu.index)">\n     <v-list-tile-avatar v-if="menuIcons">\n      <v-icon v-if="undefined==ACTIONS[action].svg">{{ACTIONS[action].icon}}</v-icon>\n      <img v-else class="svg-img" :src="ACTIONS[action].svg | svgIcon(darkUi)"></img>\n     </v-list-tile-avatar>\n     <v-list-tile-title>{{ACTIONS[action].title}}</v-list-tile-title>\n    </v-list-tile>\n   </template>\n  </v-list>\n  <v-list v-else-if="menu.history">\n   <template v-for="(item, index) in menu.history">\n    <v-list-tile @click="goTo(index)">\n     <v-list-tile-title>{{item}}</v-list-tile-title>\n    </v-list-tile>\n   </template>\n  </v-list>\n  <v-list v-else-if="menu.libraries">\n   <template v-for="(item, index) in menu.libraries">\n    <v-list-tile @click="selectLibrary(item.id)">\n     <v-list-tile-avatar><v-icon small>{{item.name==libraryName ? \'radio_button_checked\' :\'radio_button_unchecked\'}}</v-icon></v-list-tile-avatar>\n     <v-list-tile-content><v-list-tile-title>{{item.name}}</v-list-tile-title></v-list-tile-content>\n     <v-list-tile-action @click="deleteLibrary(item)" v-if="index>0"><v-btn icon><v-icon>delete_outline</v-icon></v-btn></v-list-tile-action>\n    </v-list-tile>\n   </template>\n  </v-list>\n  <v-list v-else-if="menu.albumSorts">\n   <template v-for="(item, index) in menu.albumSorts">\n    <v-list-tile @click="sortAlbums(item)">\n     <v-list-tile-avatar><v-icon small>{{item.selected ? \'radio_button_checked\' :\'radio_button_unchecked\'}}</v-icon></v-list-tile-avatar>\n     <v-list-tile-content><v-list-tile-title>{{item.label}}</v-list-tile-title></v-list-tile-content>\n    </v-list-tile>\n   </template>\n  </v-list>\n\n </v-menu>\n</div>\n      ',props:["desktop"],
data:function(){return{current:void 0,items:[],grid:{allowed:!1,use:!1,numColumns:0,size:GRID_SIZES.length-1,rows:[],few:!1,haveSubtitle:!0},fetchingItems:!1,dialog:{show:!1,title:void 0,hint:void 0,ok:void 0,cancel:void 0,command:void 0},trans:{ok:void 0,cancel:void 0,selectMultiple:void 0,addall:void 0,playall:void 0,albumRating:void 0,deleteall:void 0,removeall:void 0,choosepos:void 0},menu:{show:!1,item:void 0,x:0,y:0},isTop:!0,libraryName:void 0,selection:[],showRatingButton:!1,section:void 0,
letter:void 0,filteredJumplist:[],jumplistActive:0,jumplistWide:!1,tbarActions:[],settingsMenuActions:[],subtitleClickable:!1,disabled:new Set}},computed:{darkUi:function(){return this.$store.state.darkUi},menuIcons:function(){return this.$store.state.menuIcons},hidden:function(){return this.$store.state.hidden},sortHome:function(){return this.$store.state.sortHome},keyboardControl:function(){return this.$store.state.keyboardControl&&!IS_MOBILE}},created:function(){var a=this;this.serverMyMusic=[];
this.history=[];this.fetchingItems=!1;this.headerSubTitle=this.headerTitle=this.currentLibId=this.current=null;this.tbarActions=[];this.settingsMenuActions=[];this.mediaDirs=[];this.options={artistImages:getLocalStorageBool("artistImages",!1),pinned:new Set,sortFavorites:this.$store.state.sortFavorites,showPresets:!this.$store.state.hidden.has(TOP_PRESETS_ID)};this.previousScrollPos=0;this.grid={allowed:!1,use:!1,numColumns:0,size:GRID_SIZES.length-1,rows:[],few:!1,haveSubtitle:!0};this.desktop||
(bus.$on("nav",function(a,b){"browse"==a&&0<this.history.length&&(b?this.goHome():this.goBack())}.bind(this)),bus.$on("settingsMenuAction:browse",function(a){this.headerAction(a)}.bind(this)));bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems();var b=JSON.parse(getLocalStorageVal("topItems","[]"));0==b.length?(b=JSON.parse(getLocalStorageVal("pinned","[]")),0==b.length?lmsCommand("",["pref",LMS_MATERIAL_DEFAULT_ITEMS_PREF,"?"]).then(function(b){(b=b.data)&&b.result&&b.result._p2?
(a.updateTopList(JSON.parse(b.result._p2)),a.saveTopList()):lmsCommand("",["pref",LMS_MATERIAL_DEFAULT_PINNED_PREF,"?"]).then(function(b){(b=b.data)&&b.result&&b.result._p2&&a.addPinned(JSON.parse(b.result._p2))})}):this.addPinned(b)):this.updateTopList(b);this.disabled=new Set(JSON.parse(getLocalStorageVal("disabledItems","[]")));bus.$on("esc",function(){this.menu.show=!1}.bind(this));bus.$on("playerChanged",function(){this.current&&this.current.section==SECTION_PRESETS?this.refreshList():(this.current&&
this.current.id==TOP_MYMUSIC_ID||1<this.history.length&&this.history[1].current&&this.history[1].current.id==TOP_MYMUSIC_ID)&&this.serverMyMusicMenu()}.bind(this));bus.$on("trackInfo",function(a,b,d){50<=this.history.length&&this.goHome();this.itemMoreMenu(a,b,d)}.bind(this));bus.$on("browse",function(a,b,d){this.goHome();this.fetchItems(this.replaceCommandTerms({command:a,params:b}),{cancache:!1,id:"<>",title:d})}.bind(this));bus.$on("refreshList",function(a){(a==SECTION_PODCASTS||this.current&&
this.current.section==a)&&this.refreshList()}.bind(this));bus.$on("refreshPlaylist",function(a){this.current&&this.current.section==SECTION_PLAYLISTS&&((this.current.id.startsWith(MUSIC_ID_PREFIX)||this.current.title==a)&&this.refreshList(),!this.current.id.startsWith(MUSIC_ID_PREFIX)&&0<this.history.length&&(this.history[this.history.length-1].needsRefresh=!0))}.bind(this));bus.$on("ratingsSet",function(a,b){this.refreshList()}.bind(this));bus.$on("ratingChanged",function(a,b){this.current&&this.current.id==
"album_id:"+b&&this.refreshList()}.bind(this));bus.$on("searchLib",function(a,b,d){this.enteredTerm=d;this.fetchItems({command:a,params:b},{cancache:!1,title:i18n("Search"),id:"search"==a[0]?SEARCH_ID:"search:"+a[0],type:"search"})}.bind(this));bus.$on("searchPodcasts",function(a,b,d){this.enteredTerm=b;this.fetchUrlItems(a,d)}.bind(this));bus.$on("playerMenuUpdated",function(){this.goHome();this.serverMyMusic=[]}.bind(this));IS_MOBILE||this.mini||this.nowplaying||(bindKey("home"),bindKey(LMS_SEARCH_KEYBOARD,
"mod"),bindKey(LMS_PLAY_KEYBOARD,"mod+shift"),bindKey(LMS_APPEND_KEYBOARD,"mod+shift"),bindKey(LMS_ADD_ITEM_ACTION_KEYBOARD,"mod"),bindKey(LMS_CREATE_FAV_FOLDER_KEYBOARD,"mod+shift"),bindKey("left","mod"),bus.$on("keyboard",function(a,b){if(!(!this.$store.state.keyboardControl||0<this.$store.state.openDialogs.length||0<this.$store.state.visibleMenus.size||!this.desktop&&"browse"!=this.$store.state.page))if("mod"==b)if(LMS_SEARCH_KEYBOARD==a)0==this.history.length&&!this.$store.state.hidden.has(TOP_MYMUSIC_ID)||
this.current&&this.current.id==TOP_MYMUSIC_ID?bus.$emit("dlg.open","search"):this.current&&this.current.id==PODCASTS_ID&&bus.$emit("dlg.open","podcastsearch");else if("left"==a)this.goBack();else{b=0;for(var c=this.tbarActions.length;b<c;++b)if(ACTIONS[this.tbarActions[b]].key==a){this.headerAction(this.tbarActions[b],void 0);break}}else if("mod+shift"==b)for(b=0,c=this.tbarActions.length;b<c;++b){if(ACTIONS[this.tbarActions[b]].skey==a){LMS_PLAY_KEYBOARD==a&&0<this.selection.length?this.playSelectedItems():
LMS_APPEND_KEYBOARD==a&&0<this.selection.length?this.addSelectedItems():this.headerAction(this.tbarActions[b],void 0);break}}else b||"home"==a&&this.goHome()}.bind(this)))},methods:{initItems:function(){updateActionStrings();B_ALBUM_SORTS=[{key:"album",label:i18n("Album")},{key:"artistalbum",label:i18n("Artist, Album")},{key:"artflow",label:i18n("Artist, Year, Album")},{key:"yearalbum",label:i18n("Year, Album")},{key:"yearartistalbum",label:i18n("Year, Artist, Album")}];this.trans={ok:i18n("OK"),
cancel:i18n("Cancel"),selectMultiple:i18n("Select multiple items"),addall:i18n("Add selection to queue"),playall:i18n("Play selection"),albumRating:i18n("Set rating for all tracks"),deleteall:i18n("Delete all selected items"),removeall:i18n("Remove all selected items"),choosepos:i18n("Choose position")};if(void 0==this.top||0==this.top.length)this.top=[{command:[],params:[],icon:"library_music",type:"group",weight:0,menu:[SEARCH_LIB_ACTION],id:TOP_MYMUSIC_ID},{command:["radios"],params:["menu:radio"],
icon:"radio",type:"group",weight:1,id:TOP_RADIO_ID,section:SECTION_RADIO},{command:["favorites","items"],params:["menu:favorites","menu:1"],icon:"favorite",type:"favorites",app:"favorites",weight:2,id:TOP_FAVORITES_ID,section:SECTION_FAVORITES,isFavFolder:!0},{command:["material-skin-presets","list"],icon:"ballot",type:"presets",app:"presets",weight:3,id:TOP_PRESETS_ID,section:SECTION_PRESETS},{command:["myapps","items"],params:["menu:1"],icon:"apps",type:"group",weight:4,id:TOP_APPS_ID,section:SECTION_APPS},
{command:["cdplayer","items"],params:["menu:1"],svg:"cd-player",type:"group",weight:5,id:TOP_CDPLAYER_ID},{command:["selectRemoteLibrary","items"],params:["menu:selectRemoteLibrary","menu:1"],icon:"cloud",type:"group",weight:6,id:TOP_REMOTE_ID}];for(var a=0,b=this.top.length;a<b;++a)this.top[a].title=this.top[a].id==TOP_MYMUSIC_ID?i18n("My Music"):this.top[a].id==TOP_RADIO_ID?i18n("Radio"):this.top[a].id==TOP_FAVORITES_ID?i18n("Favorites"):this.top[a].id==TOP_PRESETS_ID?i18n("Presets"):this.top[a].id==
TOP_APPS_ID?i18n("Apps"):this.top[a].id==TOP_CDPLAYER_ID?i18n("CD Player"):this.top[a].id==TOP_REMOTE_ID?i18n("Remote Libraries"):this.top[a].title;1>this.history.length&&(this.items=this.top)},playerId:function(){return this.$store.state.player?this.$store.state.player.id:""},addHistory:function(){var a={};a.items=this.items;a.jumplist=this.jumplist;a.baseActions=this.baseActions;a.current=this.current;a.currentLibId=this.currentLibId;a.currentBaseActions=this.currentBaseActions;a.headerTitle=this.headerTitle;
a.headerSubTitle=this.headerSubTitle;a.tbarActions=this.tbarActions;a.settingsMenuActions=this.settingsMenuActions;a.pos=this.scrollElement.scrollTop;a.grid=this.grid;a.command=this.command;a.showRatingButton=this.showRatingButton;a.subtitleClickable=this.subtitleClickable;a.prevPage=this.prevPage;a.allSearchResults=this.allSearchResults;this.prevPage=void 0;this.history.push(a)},fetchItems:function(a,b,c){var e=this;if(!this.fetchingItems){this.fetchingItems=!0;var d=b.limit?b.limit:LMS_BATCH_SIZE;
lmsList(this.playerId(),a.command,a.params,0,d,b.cancache).then(function(g){g=g.data;e.options.ratingsSupport=e.$store.state.ratingsSupport;g=parseBrowseResp(g,b,e.options,b.cancache?cacheKey(a.command,a.params,0,d):void 0);e.handleListResponse(b,a,g);e.prevPage=c;e.fetchingItems=!1;e.enableRatings()}).catch(function(c){e.fetchingItems=!1;axios.isCancel(c)||(e.handleListResponse(b,a,{items:[{title:i18n("Empty"),type:"text",id:"empty"}]}),logError(c,a.command,a.params,0,d))})}},fetchUrlItems:function(a,
b){var c=this;this.fetchingItems||(this.fetchingItems=!0,axios.get(a).then(function(a){a=parseBrowseUrlResp(a.data,b);c.handleListResponse({title:i18n("Search"),type:"search"},{command:[],params:[]},a);c.fetchingItems=!1}).catch(function(a){c.fetchingItems=!1;axios.isCancel(a)||(c.handleListResponse({title:i18n("Search"),type:"search"},{command:[],params:[]},{items:[{title:i18n("Empty"),type:"text",id:"empty"}]}),logError(a,command.command,command.params))}))},handleListResponse:function(a,b,c){if(c&&
c.items&&(0<c.items.length||1==b.command.length&&("artists"==b.command[0]||"albums"==b.command[0]))){this.addHistory();this.command=b;this.currentBaseActions=this.baseActions;this.headerTitle=a.title?"search"!=a.type&&"entry"!=a.type||void 0==this.enteredTerm?a.title:a.title+SEPARATOR+this.enteredTerm:"?";this.current=a;this.currentLibId=b.libraryId;this.items=c.items;this.jumplist=c.jumplist;this.filteredJumplist=[];this.baseActions=c.baseActions;this.tbarActions=[];this.settingsMenuActions=[];this.isTop=
!1;this.subtitleClickable=!IS_MOBILE&&0<this.items.length&&this.items[0].id&&this.items[0].artist_id&&this.items[0].id.startsWith("album_id:");var e=this.grid.use!=c.useGrid;this.grid={allowed:c.canUseGrid,use:c.canUseGrid&&(c.forceGrid||isSetToUseGrid(b)),numColumns:0,size:GRID_SIZES.length-1,rows:[],few:!1,haveSubtitle:!0};this.jumplistActive=0;if(SECTION_FAVORITES==this.current.section&&this.current.isFavFolder)this.tbarActions=[ADD_FAV_FOLDER_ACTION,ADD_FAV_ACTION];else if(SECTION_PRESETS==this.current.section)this.tbarActions=
[ADD_PRESET_ACTION];else if(2==b.command.length&&"podcasts"==b.command[0]&&"items"==b.command[1]&&1==b.params.length&&"menu:podcasts"==b.params[0])this.tbarActions=[ADD_PODCAST_ACTION,SEARCH_PODCAST_ACTION];else if(addAndPlayAllActions(b)){if(this.current&&this.current.menu){b=0;for(var d=this.current.menu.length;b<d;++b)if(this.current.menu[b]==ADD_ACTION||this.current.menu[b]==PLAY_ACTION){this.tbarActions=[ADD_ACTION,PLAY_ACTION];break}}0==this.tbarActions.length&&this.current&&this.current.actions&&
this.current.actions.play&&(this.tbarActions=[ADD_ACTION,PLAY_ACTION]);!(0==this.tbarActions.length&&1<this.items.length&&this.items[0].menu&&0<this.items[0].menu.length)||this.items[0].menu[0]!=ADD_ACTION&&this.items[0].menu[0]!=PLAY_ACTION||a.id&&a.id.startsWith(TOP_ID_PREFIX)||0<this.command.command.length&&("trackinfo"==this.command.command[0]||"artistinfo"==this.command.command[0]||"albuminfo"==this.command.command[0])||"genreinfo"==this.command.command[0]||(this.tbarActions=[ADD_ALL_ACTION,
PLAY_ALL_ACTION],this.items[0].params&&this.items[0].params.item_id&&(a=this.items[0].params.item_id.split("."),1<a.length&&(a.pop(),this.current.allid="item_id:"+a.join("."))))}c.canUseGrid&&!c.forceGrid&&this.settingsMenuActions.unshift(this.grid.use?USE_LIST_ACTION:USE_GRID_ACTION);if(0<this.command.command.length&&"albums"==this.command.command[0]){a=!0;b=0;for(d=this.command.params.length;b<d;++b)if(this.command.params[b].startsWith(SORT_KEY)){a=this.command.params[b].split(":")[1];a="new"!=
a&&"random"!=a;break}a&&this.settingsMenuActions.unshift(ALBUM_SORTS_ACTION)}bus.$emit("settingsMenuActions",this.settingsMenuActions,"browse");this.headerSubTitle=c.subtitle?c.subtitle:1==this.items.length&&"text"==this.items[0].type?void 0:i18np("1 Item","%1 Items",this.items.length);this.$nextTick(function(){e&&this.setScrollElement();this.setBgndCover();this.filterJumplist();this.layoutGrid();setScrollTop(this.scrollElement,0)})}},handleTextClickResponse:function(a,b,c,e){var d=parseBrowseResp(c,
a,this.options);(c=a.nextWindow?a.nextWindow:a.actions&&a.actions.go&&a.actions.go.nextWindow?a.actions.go.nextWindow:void 0)?(c=c.toLowerCase(),a=d.items&&1==d.items.length&&"text"==d.items[0].type&&d.items[0].title&&"empty"!=d.items[0].id?d.items[0].title:a.title,"refresh"==c||e&&"parent"==c?(bus.$emit("showMessage",a),this.refreshList()):0<this.history.length&&("parent"==c||e&&"grandparent"==c)?(bus.$emit("showMessage",a),this.goBack(!0)):"grandparent"==c&&1<this.history.length&&(bus.$emit("showMessage",
a),this.history.pop(),this.goBack(!0))):3<b.command.length&&"playlist"==b.command[1]&&"play"==b.command[2]?(bus.$emit("showMessage",a.title),this.goBack(!0)):1==d.items.length&&"empty"==d.items[0].id?bus.$emit("showMessage",a.title):this.handleListResponse(a,b,d)},canClickText:function(a){return a.style&&a.style.startsWith("item")&&"itemNoAction"!=a.style||!a.style&&(a.actions&&a.actions.go||a.actions&&a.actions.do||a.nextWindow||a.params)},doTextClick:function(a,b){var c=this,e=this.buildCommand(a);
2!=e.command.length||"items"!=e.command[1]&&"browsejive"!=e.command[1]&&"jiveplaylistparameters"!=e.command[1]?0<e.command.length&&(e.params&&e.params.forEach(function(a){e.command.push(a)}),lmsCommand(this.playerId(),e.command).then(function(d){d=d.data;bus.$emit("refreshStatus");logJsonMessage("RESP",d);c.handleTextClickResponse(a,e,d,b)}).catch(function(a){logError(a,e.command)})):(this.fetchingItems=!0,lmsList(this.playerId(),e.command,e.params,0,LMS_BATCH_SIZE).then(function(d){d=d.data;c.fetchingItems=
!1;c.handleTextClickResponse(a,e,d,b)}).catch(function(a){c.fetchingItems=!1;logError(a,e.command,e.params)}))},click:function(a,b,c){var e=this;if(!this.fetchingItems&&"search"!=a.type&&"entry"!=a.type&&"html"!=a.type)if(this.menu.show)this.menu.show=!1;else if(!(0<this.$store.state.visibleMenus.size))if(a.header)a.allSearchResults&&(this.addHistory(),this.items=a.allSearchResults,this.headerSubTitle=a.subtitle,this.current=a,this.items[0].id.startsWith("album_id")&&50>=this.items.length||this.items[0].id.startsWith("track_id"))&&
(this.tbarActions=[ADD_ALL_ACTION,PLAY_ALL_ACTION]);else if(0<this.selection.length)this.select(a,b);else if(a.section==SECTION_PRESETS&&a.id!=TOP_PRESETS_ID||a.isPinned&&void 0!=a.url)this.itemMenu(a,b,c);else if("image"==a.type)this.showImage(b);else if("audio"==a.type||"track"==a.type||("itemplay"==a.style||"item_play"==a.style)&&a.menu&&0<a.menu.length||a.goAction&&("playControl"==a.goAction||"play"==a.goAction))this.$store.state.showMenuAudio&&this.itemMenu(a,b,c);else if(!isTextItem(a)||a.id.startsWith(TOP_ID_PREFIX)||
a.id.startsWith(MUSIC_ID_PREFIX))if(TOP_MYMUSIC_ID==a.id)this.addHistory(),this.items=this.serverMyMusic,this.serverMyMusicMenu(),this.headerTitle=a.title,this.headerSubTitle=i18n("Browse music library"),this.current=a,setScrollTop(this.scrollElement,0),this.isTop=!1,this.tbarActions=[VLIB_ACTION,SEARCH_LIB_ACTION];else if(RANDOM_MIX_ID==a.id)bus.$emit("dlg.open","rndmix");else if(!a.genreArtists&&a.command&&1==a.command.length&&1==a.params.length&&"artists"==a.command[0]&&a.params[0].startsWith("genre_id:")&&
this.current&&this.current.id==GENRES_ID)this.addHistory(),this.items=[{title:i18n("Artists"),command:["artists"],params:[a.params[0]],svg:"artist",type:"group",id:a.id+"artists",genreArtists:!0},{title:i18n("Albums"),command:["albums"],params:[a.params[0],ALBUM_TAGS,SORT_KEY+ALBUM_SORT_PLACEHOLDER],icon:"album",type:"group",id:a.id+"albums"}],LMS_COMPOSER_GENRES.has(a.title)&&this.items.push({title:i18n("Composers"),command:["artists"],params:["role_id:COMPOSER",a.params[0]],cancache:!0,svg:"composer",
type:"group",id:a.id+"composers"}),LMS_CONDUCTOR_GENRES.has(a.title)&&this.items.push({title:i18n("Conductors"),command:["artists"],params:["role_id:CONDUCTOR",a.params[0]],cancache:!0,svg:"conductor",type:"group",id:a.id+"conductors"}),this.headerTitle=a.title,this.headerSubTitle=i18n("Select category"),setScrollTop(this.scrollElement,0),this.isTop=!1;else if(a.weblink)window.open(a.weblink);else{var d=this.buildCommand(a);if(2<d.command.length&&"playlist"==d.command[1])!a.menu||1>a.menu.length?
lmsCommand(this.playerId(),d.params?d.command.concat(d.params):d.command).then(function(b){bus.$emit("showMessage",a.title)}):this.$store.state.showMenuAudio&&this.itemMenu(a,b,c);else{if(a.mapgenre){var g=getField(d,"genre:");if(0<=g){lmsCommand("",["material-skin","map",d.params[g]]).then(function(b){b=b.data;b.result.genre_id&&(d.params[g]="genre_id:"+b.result.genre_id,e.fetchItems(d,a))});return}}this.fetchItems(d,a)}}else this.canClickText(a)&&this.doTextClick(a)},showImage:function(a){for(var b=
this,c=[],e=0;e<this.items.length;++e)c.push({src:changeImageSizing(this.items[e].src),w:0,h:0});this.gallery=new PhotoSwipe(document.querySelectorAll(".pswp")[0],PhotoSwipeUI_Default,c,{index:a});this.gallery.listen("gettingData",function(a,c){if(1>c.w||1>c.h)a=new Image,a.onload=function(){c.w=this.width;c.h=this.height;b.gallery.updateSize(!0)},a.src=c.src});this.gallery.init();this.$store.commit("dialogOpen",{name:"browse-viewer",shown:!0});this.gallery.listen("close",function(){bus.$emit("dialogOpen",
"browse-viewer",!1)})},search:function(a,b){this.fetchingItems||(this.enteredTerm=a.target._value,void 0!=this.enteredTerm&&(this.enteredTerm=this.enteredTerm.trim(),isEmpty(this.enteredTerm)||this.fetchItems(this.buildCommand(b),b)))},entry:function(a,b){this.fetchingItems||(this.enteredTerm=a.target._value,this.doTextClick(b))},dialogResponse:function(a){var b=this;if(a&&this.dialog.value){var c=this.dialog.value.trim();if(0<c.length&&c!==this.dialog.hint)if(this.dialog.show=!1,this.dialog.item&&
this.dialog.item.isPinned)this.dialog.item.title=c,this.saveTopList();else{var e=[];this.dialog.command.forEach(function(a){e.push(a.replace(TERM_PLACEHOLDER,c))});if(this.dialog.params){var d=[];this.dialog.params.forEach(function(a){d.push(a.replace(TERM_PLACEHOLDER,c))});this.fetchItems({command:e,params:d},this.dialog.item)}else lmsCommand(this.playerId(),e).then(function(a){logJsonMessage("RESP",a.datax);b.refreshList()}).catch(function(a){logAndShowError(a,2<b.dialog.command.length&&"rename"===
b.dialog.command[1]?i18n("Rename failed"):i18n("Failed"),e)})}this.dialog={}}},itemMoreMenu:function(a,b,c){void 0!=b?this.fetchItems({command:["trackinfo","items"],params:["playlist_index:"+b,"menu:1","html:1"]},a,c):a.id&&(b=[a.id,"menu:1","html:1"],a.id.startsWith("artist_id:")?this.fetchItems({command:["artistinfo","items"],params:b},a,c):a.id.startsWith("album_id:")?this.fetchItems({command:["albuminfo","items"],params:b},a,c):a.id.startsWith("track_id:")?this.fetchItems({command:["trackinfo",
"items"],params:b},a,c):a.id.startsWith("genre_id:")&&this.fetchItems({command:["genreinfo","items"],params:b},a,c))},itemAction:function(a,b,c,e){var d=this;if(a==SEARCH_LIB_ACTION)1>this.$store.state.visibleMenus.size&&bus.$emit("dlg.open","search");else if(a===MORE_ACTION)b.isPodcast?bus.$emit("dlg.open","iteminfo",b):this.fetchItems(this.buildCommand(b,ACTIONS[a].cmd),b);else if(a===MORE_LIB_ACTION)this.itemMoreMenu(b);else if(a===PIN_ACTION)this.pin(b,!0);else if(a===UNPIN_ACTION)this.pin(b,
!1);else if(this.playerId())if(a===RENAME_ACTION)this.dialog=this.isTop||b.isPinned?{show:!0,title:i18n("Rename item"),hint:b.title,value:b.title,ok:i18n("Rename"),cancel:void 0,item:b}:SECTION_PLAYLISTS==b.section?{show:!0,title:i18n("Rename playlist"),hint:b.title,value:b.title,ok:i18n("Rename"),cancel:void 0,command:["playlists","rename",b.id,"newname:"+TERM_PLACEHOLDER]}:{show:!0,title:i18n("Rename favorite"),hint:b.title,value:b.title,ok:i18n("Rename"),cancel:void 0,command:["favorites","rename",
b.id,"title:"+TERM_PLACEHOLDER]};else if(a==ADD_FAV_ACTION||a==ADD_PRESET_ACTION)bus.$emit("dlg.open","favorite","add",{id:(this.current.id.startsWith("item_id:")?this.current.id+".":"item_id:")+this.items.length},a==ADD_PRESET_ACTION);else if(a==EDIT_ACTION)bus.$emit("dlg.open","favorite","edit",b,SECTION_PRESETS==b.section);else if(a==ADD_FAV_FOLDER_ACTION)this.dialog={show:!0,title:ACTIONS[ADD_FAV_FOLDER_ACTION].title,ok:i18n("Create"),cancel:void 0,command:["favorites","addlevel","title:"+TERM_PLACEHOLDER,
(this.current.id.startsWith("item_id:")?this.current.id+".":"item_id:")+this.items.length]};else if(a==SAVE_PRESET_ACTION||a==MOVE_PRESET_ACTION)showMenu(this,{show:!0,item:b,x:this.menu.x,y:0,presets:[1,2,3,4,5,6,7,8,9,10]});else if(a===DELETE_ACTION)this.$confirm(i18n("Delete '%1'?",b.title),{buttonTrueText:i18n("Delete"),buttonFalseText:i18n("Cancel")}).then(function(a){if(a&&b.id.startsWith("playlist_id:")){d.clearSelection();var c=["playlists","delete",b.id];lmsCommand(d.playerId(),c).then(function(a){logJsonMessage("RESP",
a.datax);d.refreshList()}).catch(function(a){logAndShowError(a,i18n("Failed to delete playlist!"),c)})}});else if(a==REMOVE_ACTION)this.$confirm(i18n("Remove '%1'?",b.title),{buttonTrueText:i18n("Remove"),buttonFalseText:i18n("Cancel")}).then(function(a){a&&(d.clearSelection(),lmsCommand(d.playerId(),SECTION_PRESETS==b.section?["material-skin-presets","clear","num:"+b.num]:["playlists","edit","cmd:delete",d.current.id,"index:"+c]).then(function(a){logJsonMessage("RESP",a.datax);d.refreshList()}).catch(function(a){logAndShowError(a,
i18n("Failed to remove '%1'!",b.title),l)}))});else if(a==ADD_TO_FAV_ACTION){updateItemFavorites(b);var g=b.favUrl?b.favUrl:b.url,f=b.favIcon,k="audio",m=b.origTitle?b.origTitle:b.title;b.presetParams&&b.presetParams.favorites_url&&(g=b.presetParams.favorites_url,f=b.presetParams.icon,k=b.presetParams.favorites_type,b.presetParams.favorites_title&&(m=b.presetParams.favorites_title));var l=["favorites","exists",g];lmsCommand(this.playerId(),l).then(function(a){a=a.data;logJsonMessage("RESP",a);a&&
a.result&&1==a.result.exists?bus.$emit("showMessage",i18n("Already in favorites")):(l=["favorites","add","url:"+g,"title:"+m],k&&l.push("type:"+k),"group"==b.type&&l.push("hasitems:1"),f&&l.push("icon:"+f),lmsCommand(d.playerId(),l).then(function(a){logJsonMessage("RESP",a.data);bus.$emit("showMessage",i18n("Added to favorites"))}).catch(function(a){logAndShowError(a,i18n("Failed to add to favorites!"),l)}))}).catch(function(a){bus.$emit("showMessage",i18n("Failed to add to favorites!"));logError(a,
l)})}else if(a===REMOVE_FROM_FAV_ACTION||a==DELETE_FAV_FOLDER_ACTION){var q=SECTION_FAVORITES==this.current.section?b.id:"url:"+(b.presetParams&&b.presetParams.favorites_url?b.presetParams.favorites_url:b.favUrl);void 0!=q&&this.$confirm(a===REMOVE_FROM_FAV_ACTION?i18n("Remove '%1' from favorites?",b.title):i18n("Delete '%1' (and all its contents)?",b.title),{buttonTrueText:a===REMOVE_FROM_FAV_ACTION?i18n("Remove"):i18n("Delete"),buttonFalseText:i18n("Cancel")}).then(function(a){if(a){d.clearSelection();
var b=["favorites","delete",q];lmsCommand(d.playerId(),b).then(function(a){logJsonMessage("RESP",a.datax);SECTION_FAVORITES==d.current.section&&d.refreshList()}).catch(function(a){logAndShowError(a,i18n("Failed to remove favorite!"),b)})}})}else if(a===MOVE_FAV_TO_PARENT_ACTION){this.clearSelection();var h=b.id.replace("item_id:","").split(".");h.pop();h.pop();0<h.length?(h=h.join("."),h+=".0"):h="0";l=["favorites","move",b.id.replace("item_id:","from_id:"),"to_id:"+h];lmsCommand(this.playerId(),
l).then(function(a){logJsonMessage("RESP",a.data);d.goBack(!0)}).catch(function(a){logAndShowError(a,i18n("Failed to move favorite!"),l)})}else if(a===ADD_RANDOM_ALBUM_ACTION){var n=[];b.params.forEach(function(a){n.push(a)});n.push(SORT_KEY+"random");lmsList(this.playerId(),["albums"],n,0,1).then(function(a){a=parseBrowseResp(a.data,d.current,d.options);if(1===a.items.length&&a.items[0].id){var b=a.items[0],c=["playlistcontrol","cmd:add",b.id];lmsCommand(d.playerId(),c).then(function(a){bus.$emit("refreshStatus");
bus.$emit("showMessage",i18n("Appended '%1' to the play queue",b.title))}).catch(function(a){bus.$emit("showError",a);logError(a,c)})}else bus.$emit("showError",void 0,i18n("Failed to find an album!"))}).catch(function(a){logAndShowError(a,void 0,["albums"],n,0,1)})}else if(SELECT_ACTION===a)h=this.selection.indexOf(c),0>h&&(this.selection.push(c),b.selected=!0,h=b.menu.indexOf(SELECT_ACTION),-1<h&&(b.menu[h]=UNSELECT_ACTION),(this.items.length>LMS_MAX_NON_SCROLLER_ITEMS||this.grid.use)&&forceItemUpdate(this,
b));else if(UNSELECT_ACTION===a)h=this.selection.indexOf(c),-1<h&&(this.selection.splice(h,1),b.selected=!1,h=b.menu.indexOf(UNSELECT_ACTION),-1<h&&(b.menu[h]=SELECT_ACTION),(this.items.length>LMS_MAX_NON_SCROLLER_ITEMS||this.grid.use)&&forceItemUpdate(this,b));else if(RATING_ACTION==a)bus.$emit("dlg.open","rating",[b.id],b.rating);else if(PLAY_ALBUM_ACTION==a)l=this.buildFullCommand(this.current,PLAY_ACTION),l.command.push("play_index:"+c),lmsCommand(this.playerId(),l.command).then(function(a){logJsonMessage("RESP",
a.data);bus.$emit("refreshStatus");d.desktop||d.$store.commit("setPage","now-playing")}).catch(function(a){logAndShowError(a,void 0,l.command)});else if(SEARCH_PODCAST_ACTION==a)bus.$emit("dlg.open","podcastsearch");else if(ADD_PODCAST_ACTION==a)b.isPodcast?lmsCommand("",["material-skin","add-podcast","url:"+b.id,"name:"+b.title]).then(function(a){d.history[d.history.length-1].needsRefresh=!0;bus.$emit("showMessage",i18n("Added '%1'",b.title))}).catch(function(a){logAndShowError(a,i18n("Failed to remove favorite!"),
l)}):bus.$emit("dlg.open","podcastadd");else if(REMOVE_PODCAST_ACTION==a)this.$confirm(i18n("Remove '%1'?",b.title),{buttonTrueText:i18n("Remove"),buttonFalseText:i18n("Cancel")}).then(function(a){a&&lmsCommand("",["material-skin","delete-podcast","pos:"+b.id.split(":")[1].split(".")[1]]).then(function(a){d.refreshList()}).catch(function(a){logAndShowError(a,i18n("Failed to remove favorite!"),l)})});else if(ADD_ALL_ACTION!=a&&PLAY_ALL_ACTION!=a||!b.id.startsWith("search:")&&!b.id.startsWith("search.")&&
b.id!=SEARCH_ID)l=this.buildFullCommand(b,a),0===l.command.length?bus.$emit("showError",void 0,i18n("Don't know how to handle this!")):lmsCommand(this.playerId(),l.command).then(function(c){logJsonMessage("RESP",c.data);bus.$emit("refreshStatus");d.clearSelection();d.desktop||(a===PLAY_ACTION||a===PLAY_ALL_ACTION?d.$store.commit("setPage","now-playing"):a!==ADD_ACTION&&a!==ADD_ALL_ACTION||void 0!=e&&e?"insert"===a&&bus.$emit("showMessage",i18n("Inserted '%1' into the play queue",b.title)):bus.$emit("showMessage",
i18n("Appended '%1' to the play queue",b.title)))}).catch(function(a){logAndShowError(a,void 0,l.command)});else{h=[];for(var t=b.id.endsWith("tracks")||SEARCH_ID==b.id&&this.items[0].id.startsWith("track")?"track_id":"album_id",u=b.allSearchResults?b.allSearchResults:this.items,p=0,v=u.length;p<v;++p)if(u[p].id.startsWith(t))h.push({act:PLAY_ALL_ACTION==a&&0==p?PLAY_ACTION:ADD_ACTION,item:u[p],idx:p});else if(0<h.length)break;bus.$emit("showMessage",b.id.endsWith("tracks")?i18n("Adding tracks..."):
i18n("Adding albums..."));this.doCommands(h,PLAY_ALL_ACTION==a)}else bus.$emit("showError",void 0,i18n("No Player"))},itemMoreAction:function(a,b){this.doTextClick(a.moremenu[b],!0)},itemMenu:function(a,b,c){var e=this;if(a.menu)if(1==a.menu.length&&MORE_ACTION==a.menu[0])if(a.moremenu)showMenu(this,{show:!0,item:a,x:c.clientX,y:c.clientY,index:b});else{var d=this.buildFullCommand(a,a.menu[0]);lmsList(this.playerId(),d.command,d.params,0,100,!1).then(function(d){d=parseBrowseResp(d.data,a,e.options,
void 0);0<d.items.length&&(a.moremenu=d.items,showMenu(e,{show:!0,item:a,x:c.clientX,y:c.clientY,index:b}))})}else showMenu(this,{show:!0,item:a,x:c.clientX,y:c.clientY,index:b})},savePreset:function(a,b){var c=this,e=["material-skin-presets","set","num:"+b,"url:"+(a.url?a.url:a.favUrl?a.favUrl:a.presetParams?a.presetParams.favorites_url:void 0),"text:"+(a.section==SECTION_PRESETS?a.text:a.title)];if(a.section==SECTION_PRESETS){if(b==a.num)return;e.push("prev:"+a.num)}lmsCommand(this.playerId(),e).then(function(b){a.section==
SECTION_PRESETS?c.refreshList():bus.$emit("showMessage",i18n("Set preset"))})},clickSubtitle:function(a,b,c){!IS_MOBILE&&a.id&&a.artist_id&&a.id.startsWith("album_id:")?this.fetchItems(this.replaceCommandTerms({command:["albums"],params:["artist_id:"+a.artist_id,"tags:jlys",SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER]}),{cancache:!1,id:a.id,title:a.subtitle}):this.click(a,b,c)},showHistory:function(a){if(1<this.history.length){var b=[];this.history.forEach(function(a){b.push(a.headerTitle?a.headerTitle:
i18n("Home"))});showMenu(this,{show:!0,x:a.clientX,y:a.clientY,history:b})}},showLibMenu:function(a){var b=this;lmsList("",["libraries"]).then(function(c){if((c=c.data)&&c.result&&c.result.folder_loop&&0<c.result.folder_loop.length){for(var e=[],d=0,g=c.result.folder_loop.length;d<g;++d)c.result.folder_loop[d].name=c.result.folder_loop[d].name.replace(SIMPLE_LIB_VIEWS,""),e.push(c.result.folder_loop[d]);e.sort(nameSort);e.unshift({name:i18n("All"),id:LMS_DEFAULT_LIBRARY});showMenu(b,{show:!0,x:a.clientX,
y:a.clientY,libraries:e})}})},selectLibrary:function(a){this.$store.commit("setLibrary",a)},deleteLibrary:function(a){var b=this;this.$confirm(i18n("Delete '%1'?",a.name),{buttonTrueText:i18n("Delete"),buttonFalseText:i18n("Cancel")}).then(function(c){c&&lmsCommand("",["material-skin","delete-vlib","id:"+a.id]).then(function(c){b.$store.state.library==a.id&&b.$store.commit("setLibrary",LMS_DEFAULT_LIBRARY)})})},sortAlbums:function(a){if(!a.selected){for(var b=0,c=this.command.params.length;b<c;++b)if(this.command.params[b].startsWith(SORT_KEY)){this.command.params[b]=
SORT_KEY+a.key;break}setAlbumSort(this.command,a.key);this.refreshList(!1)}},headerAction:function(a,b){if(!(0<this.$store.state.visibleMenus.size&&(this.desktop||0>this.settingsMenuActions.indexOf(a))))if(USE_LIST_ACTION==a)this.changeLayout(!1);else if(USE_GRID_ACTION==a)this.changeLayout(!0);else if(ALBUM_SORTS_ACTION==a){a="";for(var c=0,e=this.command.params.length;c<e;++c)if(this.command.params[c].startsWith(SORT_KEY)){a=this.command.params[c].split(":")[1];break}var d=[];c=0;for(e=B_ALBUM_SORTS.length;c<
e;++c)d.push({key:B_ALBUM_SORTS[c].key,label:B_ALBUM_SORTS[c].label,selected:a==B_ALBUM_SORTS[c].key});showMenu(this,{show:!0,x:b?b.clientX:window.innerWidth,y:b?b.clientY:0,albumSorts:d})}else VLIB_ACTION==a?this.showLibMenu(b):this.itemAction(a,this.current)},changeLayout:function(a){this.grid.use!=a&&(this.grid.use=a,this.$nextTick(function(){this.setScrollElement();this.setBgndCover();this.layoutGrid();setUseGrid(this.command,this.grid.use);for(var a=this.grid.use?USE_GRID_ACTION:USE_LIST_ACTION,
c=this.grid.use?USE_LIST_ACTION:USE_GRID_ACTION,e=0,d=this.settingsMenuActions.length;e<d;++e)if(this.settingsMenuActions[e]==a){this.settingsMenuActions[e]=c;break}bus.$emit("settingsMenuActions",this.settingsMenuActions,"browse");this.$forceUpdate()}))},refreshList:function(a){var b=this;this.clearSelection();var c=void 0==a||a?this.scrollElement.scrollTop:0;this.fetchingItems=!0;lmsList(this.playerId(),this.command.command,this.command.params,0,LMS_BATCH_SIZE,this.current.cancache).then(function(a){a=
parseBrowseResp(a.data,b.current,b.options,b.current.cancache?cacheKey(b.command.command,b.command.params,0,LMS_BATCH_SIZE):void 0);b.items=a.items;b.jumplist=a.jumplist;b.filteredJumplist=[];b.headerSubTitle=a.subtitle?a.subtitle:i18np("1 Item","%1 Items",b.items.length);b.$nextTick(function(){setScrollTop(this.scrollElement,0<c?c:0);this.filterJumplist()});b.fetchingItems=!1}).catch(function(a){axios.isCancel(a)||logAndShowError(a,void 0,b.command.command,b.command.params);b.fetchingItems=!1})},
homeBtnPressed:function(){1>this.$store.state.visibleMenus.size&&this.goHome()},goHome:function(){if(0!=this.history.length){if(this.fetchingItems)if(lmsListSource)this.fetchingItems=!1,lmsListSource.cancel(i18n("Operation cancelled by the user."));else return;this.selection=[];var a=0<this.history.length?this.history[0].pos:0;this.items=this.top;this.jumplist=[];this.filteredJumplist=[];this.history=[];this.headerSubTitle=this.headerTitle=this.currentLibId=this.current=null;this.baseActions=[];this.currentBaseActions=
[];this.tbarActions=[];this.settingsMenuActions=[];this.isTop=!0;this.grid={allowed:!1,use:!1,numColumns:0,size:GRID_SIZES.length-1,rows:[],few:!1,haveSubtitle:!0};this.command=void 0;this.subtitleClickable=this.showRatingButton=!1;this.$nextTick(function(){this.setScrollElement();this.setBgndCover();setScrollTop(this.scrollElement,0<a.pos?a.pos:0)});bus.$emit("settingsMenuActions",this.settingsMenuActions,"browse")}},goTo:function(a){if(!(a>=this.history.length))if(0==a)this.goHome();else{for(;a<
this.history.length-1;)this.history.pop();this.goBack()}},backBtnPressed:function(a){1>this.$store.state.visibleMenus.size&&(a?this.goHome():this.goBack())},goBack:function(a){if(this.fetchingItems)lmsListSource&&(this.fetchingItems=!1,lmsListSource.cancel(i18n("Operation cancelled by the user.")));else if(this.prevPage&&!this.desktop&&this.$store.commit("setPage",this.prevPage),2>this.history.length)this.goHome();else{this.selection=[];var b=this.history.pop(),c=this.grid.use!=b.grid.use;this.items=
b.items;this.jumplist=b.jumplist;this.filteredJumplist=[];this.grid=b.grid;this.baseActions=b.baseActions;this.current=b.current;this.currentBaseActions=b.currentBaseActions;this.headerTitle=b.headerTitle;this.headerSubTitle=b.headerSubTitle;this.tbarActions=b.tbarActions;this.settingsMenuActions=b.settingsMenuActions;this.command=b.command;this.showRatingButton=b.showRatingButton;this.subtitleClickable=b.subtitleClickable;this.prevPage=b.prevPage;this.allSearchResults=b.allSearchResults;a||b.needsRefresh?
this.refreshList():this.$nextTick(function(){c&&this.setScrollElement();this.setBgndCover();this.filterJumplist();this.layoutGrid();setScrollTop(this.scrollElement,0<b.pos?b.pos:0)});bus.$emit("settingsMenuActions",this.settingsMenuActions,"browse")}},buildCommand:function(a,b,c){var e=this,d=void 0;if(ACTIONS[PLAY_ALL_ACTION].cmd==b||ACTIONS[ADD_ALL_ACTION].cmd==b)a=this.items[0],d=b,b=ACTIONS[PLAY_ALL_ACTION].cmd==b?"play":"add";var g={command:[],params:[]};if(void 0===a||null===a)return console.error("Null item passed to buildCommand????"),
g;void 0==b&&(a.command&&0<a.command.length&&a.command.forEach(function(a){g.command.push(a)}),a.params&&0<a.params.length&&a.params.forEach(function(a){g.params.push(a)}));if(1>g.command.length){void 0==b&&(b="go");var f=this.current==a?this.currentBaseActions:this.baseActions;if(b=a.actions&&a.actions[b]?a.actions[b]:"go"==b&&a.actions&&a.actions["do"]?a.actions["do"]:f?f[b]?f[b]:"go"==b&&f["do"]?f["do"]:void 0:void 0){g.command=[];b.cmd&&b.cmd.forEach(function(a){g.command.push(a)});g.params=[];
f=new Set;if(b.params)for(var k in b.params)if(void 0!=b.params[k]&&null!=b.params[k]){var m=k+":"+b.params[k];g.params.push(m);f.add(m)}if(b.itemsParams&&a[b.itemsParams])for(k in a[b.itemsParams])"touchToPlaySingle"!=k&&"touchToPlay"!=k&&(m=k+":"+a[b.itemsParams][k],f.has(m)||g.params.push(m))}if(2==g.command.length&&"browselibrary"==g.command[0]&&"items"==g.command[1]){a=[];var l=[];k=!0;b=void 0;for(var q=m=f=!1,h=0,n=g.params,t=n.length;h<t;++h)if(n[h].startsWith("mode:")){b=n[h].split(":")[1];
if(b.startsWith("myMusicArtists"))b="artists";else if(b.startsWith("myMusicAlbums")||"randomalbums"==b)b="albums";else if("vaalbums"==b)b="albums",a.push("compilation:1");else if("years"==b)a.push("hasAlbums:1");else if("artists"!=b&&"albums"!=b&&"genres"!=b&&"tracks"!=b&&"playlists"!=b){k=!1;break}l.push(b)}else n[h].startsWith("menu:")||(n[h].startsWith("tags:")?(0>n[h].split(":")[1].indexOf("s")&&(h+="s"),a.push(n[h]),m=!0):(a.push(n[h]),n[h].startsWith(SORT_KEY)?f=!0:n[h].startsWith("artist_id:")&&
(q=!0)));k&&1==l.length&&b&&("tracks"==b?(m||a.push(TRACK_TAGS),f||a.push(SORT_KEY+"tracknum")):"albums"==b?(m||a.push(ALBUM_TAGS),f||a.push(SORT_KEY+(q?ARTIST_ALBUM_SORT_PLACEHOLDER:ALBUM_SORT_PLACEHOLDER))):"playlists"==b?m||a.push(PLAYLIST_TAGS):m||"artists"!=b&&"years"!=b&&"genres"!=b&&"vaalbums"!=b||a.push("tags:s"),g={command:l,params:a})}}if(void 0==c||c)g=this.replaceCommandTerms(g);!d||ACTIONS[PLAY_ALL_ACTION].cmd!=d&&ACTIONS[ADD_ALL_ACTION].cmd!=d||(l={command:[],params:[]},g.command.forEach(function(a){"play"==
a||"add"==a?l.command.push(d):l.command.push(a)}),g.params.forEach(function(a){a.startsWith("item_id:")?l.params.push(void 0==e.current.allid?e.current.id:e.current.allid):l.params.push(a)}),g=l);return g},buildFullCommand:function(a,b){var c=this.buildCommand(a,ACTIONS[b].cmd);1>c.command.length&&(a.url&&(a.section&&a.section==SECTION_PRESETS||!a.id||!a.id.startsWith("playlist_id:"))?c.command=["playlist",INSERT_ACTION==b?"insert":ACTIONS[b].cmd,a.url,a.title]:a.app&&a.id?c.command=[a.app,"playlist",
INSERT_ACTION==b?"insert":ACTIONS[b].cmd,a.id]:a.isFolderItem?c.command=["playlist",INSERT_ACTION==b?"insert":ACTIONS[b].cmd,a.id]:a.id&&(c.command=["playlistcontrol","cmd:"+(b==PLAY_ACTION?"load":INSERT_ACTION==b?"insert":ACTIONS[b].cmd)],(a.id.startsWith("album_id:")||a.id.startsWith("artist_id:"))&&a.params.forEach(function(b){if(!lmsOptions.noRoleFilter&&b.startsWith("role_id:")||!lmsOptions.noGenreFilter&&b.startsWith("genre_id:")||b.startsWith("artist_id:"))a.id.startsWith("artist_id:")&&b.startsWith("artist_id:")||
c.command.push(b)}),c.command.push(originalId(a.id))),c=this.replaceCommandTerms(c));if(0===c.command.length)return c;0<c.params.length&&c.params.forEach(function(a){c.command.push(a)});return c},replaceCommandTerms:function(a){var b=this;if(shouldAddLibraryId(a)){for(var c=!1,e=0,d=a.params.length;e<d;++e)if(a.params[e].startsWith("library_id:")){c=!0;a.libraryId=a.params[e].split(":")[1];break}!c&&(c=this.currentLibId?this.currentLibId:this.$store.state.library?this.$store.state.library:LMS_DEFAULT_LIBRARY)&&
(a.params.push("library_id:"+c),a.libraryId=c)}if(0<a.params.length){var g=[],f=getAlbumSort(a);a.params.forEach(function(a){r=a.replace(SORT_KEY+ALBUM_SORT_PLACEHOLDER,SORT_KEY+f).replace(SORT_KEY+ARTIST_ALBUM_SORT_PLACEHOLDER,SORT_KEY+f).replace(TERM_PLACEHOLDER,b.enteredTerm);b.$store.state.ratingsSupport&&a==TRACK_TAGS&&(r=TRACK_TAGS+"R");g.push(r)});a.params=g}return a},setLibrary:function(){var a=this;this.libraryName=void 0;lmsList("",["libraries"]).then(function(b){var c=b.data;if(c&&c.result&&
c.result.folder_loop&&0<c.result.folder_loop.length){b=0;c=c.result.folder_loop;for(var e=c.length;b<e;++b)if(c[b].id==a.$store.state.library){a.libraryName=c[b].id!=LMS_DEFAULT_LIBRARY?c[b].name.replace(SIMPLE_LIB_VIEWS,""):i18n("All");break}void 0==a.libraryName&&(a.libraryName=i18n("All"))}})},serverMyMusicMenu:function(){var a=this;0<this.serverMyMusic.length&&this.serverMyMusic[0].player==this.playerId()||(this.fetchingItems=!0,lmsList(this.playerId(),["menu","items"],["direct:1"]).then(function(b){var c=
b.data;if(c&&c.result&&c.result.item_loop){a.serverMyMusic=[];b=0;c=c.result.item_loop;for(var e=c.length;b<e;++b){var d=c[b];if("myMusic"==d.node&&d.id)if("randomplay"==d.id)a.serverMyMusic.push({title:i18n("Random Mix"),svg:"dice-multiple",id:RANDOM_MIX_ID,type:"app",weight:d.weight?parseFloat(d.weight):100});else if(!d.id.startsWith("myMusicSearch")&&!d.id.startsWith("opmlselect")){var g=a.buildCommand(d,"go",!1),f={title:d.text,command:g.command,params:g.params,weight:d.weight?parseFloat(d.weight):
100,id:MUSIC_ID_PREFIX+d.id,type:"group",icon:"music_note"};d.id.startsWith("myMusicArtists")?(mapArtistIcon(g.params,f),f.cancache=!0):d.id.startsWith("myMusicAlbumsVariousArtists")?(f.icon=void 0,f.svg="album-multi",f.cancache=!0):d.id.startsWith("myMusicAlbums")?(f.icon="album",f.cancache=!0):d.id.startsWith("myMusicGenres")?(f.icon="label",f.cancache=!0,f.id=GENRES_ID):"myMusicPlaylists"==d.id||d.id.startsWith("playlists")?(f.icon="list",f.section=SECTION_PLAYLISTS):d.id.startsWith("myMusicYears")?
(f.icon="date_range",f.cancache=!0):"myMusicNewMusic"==d.id?f.icon="new_releases":d.id.startsWith("myMusicMusicFolder")?f.icon="folder":d.id.startsWith("myMusicFileSystem")?f.icon="computer":"myMusicRandomAlbums"==d.id?(f.svg="dice-album",f.icon=void 0):d.id.startsWith("myMusicTopTracks")?f.icon="arrow_upward":d.id.startsWith("myMusicFlopTracks")?f.icon="arrow_downward":"dynamicplaylist"==d.id?(f.svg="dice-list",f.icon=void 0):d.id.startsWith("trackstat")?f.icon="bar_chart":d.id.startsWith("artist")?
(f.svg="artist",f.icon=void 0):"custombrowse"==d.id||d.menuIcon&&d.menuIcon.endsWith("/custombrowse.png")?(1==g.params.length&&g.params[0].startsWith("hierarchy:new")&&(f.limit=void 0==a.newMusicLimit?100:a.newMusicLimit),d.id.startsWith("artist")?(f.svg="artist",f.icon=void 0):f.icon=d.id.startsWith("new")?"new_releases":d.id.startsWith("album")?"album":d.id.startsWith("artist")?"group":d.id.startsWith("decade")||d.id.startsWith("year")?"date_range":d.id.startsWith("genre")?"label":d.id.startsWith("playlist")?
"list":d.id.startsWith("ratedmysql")?"star":"music_note"):d.icon&&(d.icon.endsWith("/albums.png")?f.icon="album":d.icon.endsWith("/artists.png")?f.svg="artist":d.icon.endsWith("/genres.png")&&(f.icon="label"));0<=getField(f,"genre_id:")&&(f.mapgenre=!0);a.serverMyMusic.push(f)}}a.serverMyMusic.sort(function(a,b){return a.weight!=b.weight?a.weight<b.weight?-1:1:titleSort(a,b)});a.serverMyMusic[0].player=a.playerId();b=0;for(c=a.serverMyMusic.length;b<c;++b)a.serverMyMusic[b].menu=[a.options.pinned.has(a.serverMyMusic[b].id)?
UNPIN_ACTION:PIN_ACTION];a.current&&TOP_MYMUSIC_ID==a.current.id?a.items=a.serverMyMusic:1<a.history.length&&a.history[1].current&&a.history[1].current.id==TOP_MYMUSIC_ID&&(a.history[1].items=a.serverMyMusic)}a.fetchingItems=!1}).catch(function(b){a.fetchingItems=!1;logAndShowError(b)}))},updateTopList:function(a){this.top=a;this.initItems();a=0;for(var b=this.top.length;a<b;++a)this.top[a].id.startsWith(TOP_ID_PREFIX)?this.top[a].id==TOP_CDPLAYER_ID&&0==this.top[a].params.length&&this.top[a].params.push("menu:1"):
this.options.pinned.add(this.top[a].id);this.$store.state.sortHome&&this.top.sort(homeScreenSort)},saveTopList:function(){this.$store.state.sortHome&&this.top.sort(homeScreenSort);setLocalStorageVal("topItems",JSON.stringify(this.top));removeLocalStorage("pinned")},addPinned:function(a){for(var b=a.length,c=b-1;0<=c;--c)void 0==a[c].command&&void 0==a[c].params&&void 0!=a[c].item&&(b=this.buildCommand(a[c].item),a[c].params=b.params,a[c].command=b.command,a[c].image=a[c].item.image,a[c].icon=a[c].item.icon,
a[c].item=void 0),a[c].menu=void 0==a[c].url?[RENAME_ACTION,UNPIN_ACTION]:[PLAY_ACTION,INSERT_ACTION,ADD_ACTION,DIVIDER,RENAME_ACTION,UNPIN_ACTION],this.options.pinned.add(a[c].id),this.top.unshift(a[c]);1>this.history.length&&(this.items=this.top);c=0;for(b=this.serverMyMusic.length;c<b;++c)this.serverMyMusic[c].menu=[this.options.pinned.has(this.serverMyMusic[c].id)?UNPIN_ACTION:PIN_ACTION];this.saveTopList();removeLocalStorage("pinned")},pin:function(a,b,c){for(var e=this,d=-1,g=-1,f=0,k=this.top.length;f<
k;++f)if(this.top[f].id==a.id){d=f;break}else this.top[f].id.startsWith(TOP_ID_PREFIX)||(g=f);if(b&&-1==d){if(a.mapgenre&&!c){var m=getField(a,"genre_id:");if(0<=m){lmsCommand("",["material-skin","map",a.params[m]]).then(function(c){c=c.data;c.result.genre&&(a.params[m]="genre:"+c.result.genre,e.pin(a,b,!0))});return}}a.isRadio?this.top.splice(g+1,0,{id:a.presetParams.favorites_url,title:a.title,image:a.image,icon:a.icon,svg:a.svg,isPinned:!0,url:a.presetParams.favorites_url,menu:[PLAY_ACTION,INSERT_ACTION,
ADD_ACTION,DIVIDER,RENAME_ACTION,UNPIN_ACTION],weight:void 0==a.weight?1E4:a.weight}):(c=this.buildCommand(a,void 0,!1),this.top.splice(g+1,0,{id:a.id,title:a.title,image:a.image,icon:a.icon,svg:a.svg,mapgenre:a.mapgenre,command:c.command,params:c.params,isPinned:!0,menu:[RENAME_ACTION,UNPIN_ACTION],weight:void 0==a.weight?1E4:a.weight,section:a.section,cancache:a.cancache}));this.options.pinned.add(a.id);this.updateItemPinnedState(a);this.saveTopList();bus.$emit("showMessage",i18n("Pinned '%1' to home screen.",
a.title))}else b||-1==d||this.$confirm(i18n("Un-pin '%1'?",a.title),{buttonTrueText:i18n("Un-pin"),buttonFalseText:i18n("Cancel")}).then(function(b){b&&(e.top.splice(d,1),e.options.pinned.delete(a.id),e.updateItemPinnedState(a),e.saveTopList())})},updateItemPinnedState:function(a){if(a.menu){for(var b=0,c=a.menu.length;b<c;++b)if(a.menu[b]==PIN_ACTION||a.menu[b]==UNPIN_ACTION){a.menu[b]=a.menu[b]==PIN_ACTION?UNPIN_ACTION:PIN_ACTION;break}if(a.id.startsWith(TOP_ID_PREFIX))for(b=0,c=this.serverMyMusic.length;b<
c;++b)this.serverMyMusic[b].menu=[this.options.pinned.has(this.serverMyMusic[b].id)?UNPIN_ACTION:PIN_ACTION]}},clearSelection:function(){for(var a=0,b=this.selection.length;a<b;++a){var c=this.selection[a];if(-1<c&&c<this.items.length){var e=this.items[c].menu.indexOf(UNSELECT_ACTION);-1<e&&(this.items[c].menu[e]=SELECT_ACTION);this.items[c].selected=!1}}0<this.selection.length&&(this.items.length>LMS_MAX_NON_SCROLLER_ITEMS||this.grid.use)&&this.$nextTick(function(){this.items=JSON.parse(JSON.stringify(this.items))});
this.selection=[]},select:function(a,b){0<this.selection.length&&this.itemAction(0>this.selection.indexOf(b)?SELECT_ACTION:UNSELECT_ACTION,a,b)},deleteSelectedItems:function(a){var b=this;1==this.selection.length?this.itemAction(a,this.items[this.selection[0]],this.selection[0]):this.$confirm(REMOVE_ACTION==a||REMOVE_FROM_FAV_ACTION==a?i18n("Remove the selected items?"):i18n("Delete the selected items?"),{buttonTrueText:REMOVE_ACTION==a||REMOVE_FROM_FAV_ACTION==a?i18n("Remove"):i18n("Delete"),buttonFalseText:i18n("Cancel")}).then(function(c){if(c){var e=
[];b.selection.sort(function(a,c){return(void 0!=b.items[c].realIndex?b.items[c].realIndex:c)-(void 0!=b.items[c].realIndex?b.items[a].realIndex:a)});REMOVE_ACTION==a?(b.selection.forEach(function(a){e.push("index:"+a)}),bus.$emit("doAllList",e,["playlists","edit","cmd:delete",b.current.id],b.current.section)):(b.selection.forEach(function(a){e.push(b.items[a].id)}),bus.$emit("doAllList",e,b.current.section==SECTION_PLAYLISTS?["playlists","delete"]:["favorites","delete"],b.current.section));b.clearSelection()}})},
addSelectedItems:function(){var a=[];this.selection.sort(function(a,b){return a<b?-1:1});for(var b=0,c=this.selection.length;b<c;++b){var e=this.selection[b];-1<e&&e<this.items.length&&a.push({act:ADD_ACTION,item:this.items[e],idx:e})}this.doCommands(a,!1);this.clearSelection()},playSelectedItems:function(){var a=[];this.selection.sort(function(a,b){return a<b?-1:1});for(var b=0,c=this.selection.length;b<c;++b){var e=this.selection[b];-1<e&&e<this.items.length&&a.push({act:0==b?PLAY_ACTION:ADD_ACTION,
item:this.items[e],idx:e})}this.doCommands(a,!0);this.clearSelection()},doCommands:function(a,b){var c=this;if(0<a.length){var e=a.shift(),d=this.buildFullCommand(e.item,e.act);0===d.command.length?bus.$emit("showError",void 0,i18n("Don't know how to handle this!")):lmsCommand(this.playerId(),d.command).then(function(e){logJsonMessage("RESP",e.data);b&&0==a.length&&!c.desktop&&c.$store.commit("setPage","now-playing");c.doCommands(a,b)}).catch(function(a){logError(a,d.command)})}else bus.$emit("refreshStatus")},
setScrollElement:function(){this.scrollElement=document.getElementById(this.grid.use?"browse-grid":"browse-list");this.scrollElement.removeEventListener("scroll",this.handleScroll);this.scrollElement.addEventListener("scroll",this.handleScroll)},handleScroll:function(){var a=this;this.menu.show=!1;void 0!=this.filteredJumplist&&1<this.filteredJumplist.length&&!this.scrollAnimationFrameReq&&(this.scrollAnimationFrameReq=window.requestAnimationFrame(function(){a.scrollAnimationFrameReq=void 0;void 0!==
a.letterTimeout&&clearTimeout(a.letterTimeout);var b=a.grid.haveSubtitle?0:GRID_SINGLE_LINE_DIFF;b=a.grid.use?Math.floor((a.scrollElement.scrollTop+(50-b))/(GRID_SIZES[a.grid.size].ih-b))*a.grid.numColumns:Math.floor(a.scrollElement.scrollTop/LMS_LIST_ELEMENT_SIZE);if(a.$store.state.letterOverlay){if(0<=b&&b<a.items.length){var c=a.items[b].textkey;a.letter!=c&&(a.letter=c,a.letterOverlay.innerHTML=c);a.letterTimeout=setTimeout(function(){this.letter=void 0}.bind(a),500)}else a.letter=void 0;a.letterTimeout=
setTimeout(function(){this.letter=void 0}.bind(a),500)}else a.letter=void 0;c=a.jumplistActive=0;for(var e=a.filteredJumplist.length;c<e;++c)if(a.filteredJumplist[c].index<=b)a.jumplistActive=c;else break}))},layoutGrid:function(){if(this.grid.use){for(var a=!1,b=this.pageElement.scrollWidth-((this.mobileBrowser?0:20)+(1<this.filteredJumplist.length&&10<this.items.length?32:0)+4),c=0,e=1;e<GRID_SIZES.length&&b>2*(GRID_SIZES[e].iw+8);++e)c=e;var d=!1,g=Math.min(Math.floor(b/(GRID_SIZES[c].iw+8)),this.items.length);
if(g!=this.grid.numColumns){a=!0;this.grid.rows=[];for(e=0;e<this.items.length;e+=g){for(var f=[],k=0;k<g;++k)f.push(e+k),!d&&e+k<this.items.length&&this.items[e+k].subtitle&&(d=!0);this.grid.rows.push({id:"row."+e+"."+g,indexes:f})}this.grid.numColumns=g}else for(e=0;e<this.items.length&&!d;++e)this.items[e].subtitle&&(d=!0);this.grid.haveSubtitle!=d&&(this.grid.haveSubtitle=d,a=!0);this.grid.size!=c&&(this.grid.size=c,a=!0);b=1==this.grid.rows.length&&(1==this.items.length||this.items.length*GRID_SIZES[c].iw*
1.2<b);this.grid.few!=b&&(this.grid.few=b,a=!0);a&&this.$forceUpdate()}},setBgndCover:function(){var a=this.$store.state.browseBackdrop&&this.current&&this.current.image&&!this.current.image.startsWith("/plugins/")?this.current.image:void 0;a&&(a=changeImageSizing(a,LMS_CURRENT_IMAGE_SIZE));setBgndCover(this.scrollElement,a,this.$store.state.darkUi)},enableRatings:function(){this.showRatingButton=this.$store.state.ratingsSupport&&!(this.current&&this.current.id&&this.current.id.startsWith("playlist_id:"))&&
!(this.current&&this.current.actions&&this.current.actions.go&&this.current.actions.go.cmd&&1<this.current.actions.go.cmd.length&&"trackstat"==this.current.actions.go.cmd[0])&&this.items[0].id&&this.items[0].id.startsWith("track_id:")&&this.items[this.items.length-1].id&&this.items[this.items.length-1].id.startsWith("track_id:")},setAlbumRating:function(){var a=[],b=0,c=0;this.items.forEach(function(e){a.push(e.id);e.rating&&0<e.rating&&(b+=e.rating,c++)});bus.$emit("dlg.open","rating",a,Math.ceil(b/
c))},checkFeature:function(a,b){var c=this;lmsCommand("",a).then(function(a){(a=a.data)&&a.result&&void 0!=a.result._can&&((a=1==a.result._can)&&c.disabled.has(b)?(c.disabled.delete(b),setLocalStorageVal("disabledItems",JSON.stringify(Array.from(c.disabled)))):a||c.disabled.has(b)||(c.disabled.add(b),setLocalStorageVal("disabledItems",JSON.stringify(Array.from(c.disabled)))))})},jumpTo:function(a){a=this.grid.use?Math.floor(a.index/this.grid.numColumns)*(GRID_SIZES[this.grid.size].ih-(this.grid.haveSubtitle?
0:GRID_SINGLE_LINE_DIFF)):a.index*LMS_LIST_ELEMENT_SIZE;setScrollTop(this.scrollElement,0<a?a:0)},filterJumplist:function(){if(!(25>=this.items.length)){if(IS_MOBILE&&(void 0==this.jumplist||1>this.jumplist.length)){this.jumplist=[];for(var a=this.items.length/100,b=0;100>b;++b)this.jumplist.push({key:"\u2022",index:Math.round(b*a)})}if(!(void 0==this.jumplist||1>this.jumplist.length)&&(this.filteredJumplist=shrinkAray(this.jumplist,Math.floor((this.scrollElement.clientHeight-16)/20)),this.jumplistWide=
1<this.filteredJumplist[this.filteredJumplist.length-1].key.length,this.$store.state.largeFonts&&this.jumplistWide))for(b=0,a=this.filteredJumplist.length;b<a;++b)4<=this.filteredJumplist[b].key.length&&(this.filteredJumplist[b].key=this.filteredJumplist[b].key.slice(-2))}},dragStart:function(a,b){b.dataTransfer.dropEffect="move";b.dataTransfer.setData("Text",this.id);this.dragIndex=a;this.stopScrolling=!1;0<this.selection.length&&(0>this.selection.indexOf(a)||this.current.isFavFolder)&&this.clearSelection()},
dragEnd:function(){this.stopScrolling=!0;this.dragIndex=void 0},dragOver:function(a){this.stopScrolling=!0;110>a.clientY&&(this.stopScrolling=!1,this.scrollList(-5));a.clientY>window.innerHeight-70&&(this.stopScrolling=!1,this.scrollList(5));a.preventDefault()},scrollList:function(a){var b=this.scrollElement.scrollTop+a;setScrollTop(this.scrollElement,b);if(0>=b||b>=this.scrollElement.scrollTopMax)this.stopScrolling=!0;this.stopScrolling||setTimeout(function(){this.scrollList(a)}.bind(this),100)},
drop:function(a,b){var c=this;this.stopScrolling=!0;b.preventDefault();void 0!=this.dragIndex&&a!=this.dragIndex&&(b=this.selection.slice(),this.clearSelection(),0<b.length?this.current.section!=SECTION_FAVORITES&&0>b.indexOf(a)&&bus.$emit("movePlaylistItems",this.current.id,b.sort(function(a,b){return a<b?-1:1}),a):this.isTop?(this.items=arrayMove(this.top,this.dragIndex,a),this.saveTopList()):!this.current||this.current.section!=SECTION_FAVORITES&&this.current.section!=SECTION_PLAYLISTS||(a=this.current.section==
SECTION_FAVORITES?["favorites","move",this.items[this.dragIndex].id.replace("item_id:","from_id:"),this.items[a].id.replace("item_id:","to_id:")+(this.items[a].isFavFolder?".0":"")]:["playlists","edit","cmd:move",this.current.id,"index:"+this.dragIndex,"toindex:"+a],lmsCommand(this.playerId(),a).then(function(a){c.refreshList()})));this.dragIndex=void 0}},mounted:function(){var a=this;this.mobileBrowser=isMobile();this.pageElement=document.getElementById("browse-view");var b=void 0;window.addEventListener("resize",
function(){if(a.items.length>LMS_MAX_NON_SCROLLER_ITEMS||a.grid.use)b&&clearTimeout(b),b=setTimeout(function(){a.filterJumplist()},50)},!1);lmsCommand("",["serverstatus",0,0,"prefs:useUnifiedArtistsList,noGenreFilter,noRoleFilter,browseagelimit,mediadirs,useLocalImageproxy"]).then(function(b){if((b=b.data)&&b.result){var c=1!=parseInt(b.result.useUnifiedArtistsList);c!=getLocalStorageBool("separateArtists",!1)&&(setLocalStorageVal("separateArtists",c),clearListCache(!0));lmsOptions.noGenreFilter=
1==parseInt(b.result.noGenreFilter);setLocalStorageVal("noGenreFilter",lmsOptions.noGenreFilter);lmsOptions.noRoleFilter=1==parseInt(b.result.noRoleFilter);setLocalStorageVal("noRoleFilter",lmsOptions.noRoleFilter);void 0!=b.result.browseagelimit&&(a.newMusicLimit=parseInt(b.result.browseagelimit));a.mediaDirs=b.result.mediadirs;useMySqueezeboxImageProxy=void 0==b.result.useLocalImageproxy||0==parseInt(b.result.useLocalImageproxy)}});lmsCommand("",["pref","plugin.musicartistinfo:browseArtistPictures",
"?"]).then(function(b){(b=b.data)&&b.result&&null!=b.result._p2&&(a.options.artistImages=1==b.result._p2,setLocalStorageVal("artistImages",a.options.artistImages))});this.checkFeature(["can","selectRemoteLibrary","items","?"],TOP_REMOTE_ID);this.checkFeature(["can","cdplayer","items","?"],TOP_CDPLAYER_ID);bus.$on("browseDisplayChanged",function(){this.options.sortFavorites=this.$store.state.sortFavorites;this.options.showPresets=this.$store.state.hidden.has(TOP_PRESETS_ID);this.$store.state.sortHome&&
this.saveTopList();this.goHome()}.bind(this));bus.$on("libraryChanged",function(){this.setLibrary()}.bind(this));this.setLibrary();this.setScrollElement();this.$nextTick(function(){setScrollTop(this.scrollElement,0)});bus.$on("splitterChanged",function(){this.layoutGrid()}.bind(this));bus.$on("windowWidthChanged",function(){this.layoutGrid()}.bind(this));bus.$on("themeChanged",function(){this.setBgndCover()}.bind(this));this.setBgndCover();this.letterOverlay=document.getElementById("letterOverlay")},
filters:{itemTooltip:function(a){return void 0==a?"":a.title&&a.subtitle?a.title+"\n"+a.subtitle:a.title},displaySelectionCount:function(a){return a?i18np("1 Selected Item","%1 Selected Items",a):""},svgIcon:function(a,b){return"/material/svg/"+a+"?c="+(b?LMS_DARK_SVG:LMS_LIGHT_SVG)+"&r="+LMS_MATERIAL_REVISION},tooltip:function(a,b){return b&&ACTIONS[a].key?ACTIONS[a].title+SEPARATOR+shortcutStr(ACTIONS[a].key):b&&ACTIONS[a].skey?ACTIONS[a].title+SEPARATOR+shortcutStr(ACTIONS[a].skey,!0):ACTIONS[a].title}},
watch:{"menu.show":function(a){this.$store.commit("menuVisible",{name:"browse",shown:a})}}});
