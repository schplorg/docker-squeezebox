var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,m,l){e instanceof String&&(e=String(e));for(var C=e.length,w=0;w<C;w++){var D=e[w];if(m.call(l,D,w,e))return{i:w,v:D}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,m,l){e!=Array.prototype&&e!=Object.prototype&&(e[m]=l.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,m,l,C){if(m){l=$jscomp.global;e=e.split(".");for(C=0;C<e.length-1;C++){var w=e[C];w in l||(l[w]={});l=l[w]}e=e[e.length-1];C=l[e];m=m(C);m!=C&&null!=m&&$jscomp.defineProperty(l,e,{configurable:!0,writable:!0,value:m})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,l){return $jscomp.findInternal(this,e,l).v}},"es6","es3");$jscomp.checkStringArgs=function(e,m,l){if(null==e)throw new TypeError("The 'this' value for String.prototype."+l+" must not be null or undefined");if(m instanceof RegExp)throw new TypeError("First argument to String.prototype."+l+" must not be a regular expression");return e+""};
$jscomp.polyfill("String.prototype.startsWith",function(e){return e?e:function(e,l){var m=$jscomp.checkStringArgs(this,e,"startsWith");e+="";var w=m.length,D=e.length;l=Math.max(0,Math.min(l|0,m.length));for(var O=0;O<D&&l<w;)if(m[l++]!=e[O++])return!1;return O>=D}},"es6","es3");
(function(e,m){"object"===typeof exports?module.exports=m():"function"===typeof define&&define.amd?define([],m):(e.org=e.org||{},e.org.cometd=m())})(this,function(){function e(){var b={};self.onmessage=function(d){var c=d.data;d=b[c.id];switch(c.type){case "setTimeout":b[c.id]=self.setTimeout(function(){delete b[c.id];self.postMessage({id:c.id})},c.delay);break;case "clearTimeout":delete b[c.id];d&&self.clearTimeout(d);break;default:throw"Unknown command "+c.type;}}}var m=function(){var b=0,d={};
this.register=function(c){var g=++b;d[g]=c;return g};this.unregister=function(c){var g=d[c];delete d[c];return g};this.setTimeout=function(c,g){return window.setTimeout(c,g)};this.clearTimeout=function(c){window.clearTimeout(c)}},l={isString:function(b){return void 0===b||null===b?!1:"string"===typeof b||b instanceof String},isArray:function(b){return void 0===b||null===b?!1:b instanceof Array},inArray:function(b,d){for(var c=0;c<d.length;++c)if(b===d[c])return c;return-1}},C=function(){var b=[],
d={};this.getTransportTypes=function(){return b.slice(0)};this.findTransportTypes=function(c,g,u){for(var k=[],e=0;e<b.length;++e){var n=b[e];!0===d[n].accept(c,g,u)&&k.push(n)}return k};this.negotiateTransport=function(c,g,u,k){for(var e=0;e<b.length;++e)for(var n=b[e],l=0;l<c.length;++l)if(n===c[l]){var y=d[n];if(!0===y.accept(g,u,k))return y}return null};this.add=function(c,g,u){for(var k=!1,e=0;e<b.length;++e)if(b[e]===c){k=!0;break}k||("number"!==typeof u?b.push(c):b.splice(u,0,c),d[c]=g);return!k};
this.find=function(c){for(var g=0;g<b.length;++g)if(b[g]===c)return d[c];return null};this.remove=function(c){for(var g=0;g<b.length;++g)if(b[g]===c)return b.splice(g,1),g=d[c],delete d[c],g;return null};this.clear=function(){b=[];d={}};this.reset=function(c){for(var g=0;g<b.length;++g)d[b[g]].reset(c)}},w=function(){var b,d,c;this.registered=function(c,u){b=c;d=u};this.unregistered=function(){d=b=null};this._debug=function(){d._debug.apply(d,arguments)};this._mixin=function(){return d._mixin.apply(d,
arguments)};this.getConfiguration=function(){return d.getConfiguration()};this.getAdvice=function(){return d.getAdvice()};this.setTimeout=function(c,b){return d.setTimeout(c,b)};this.clearTimeout=function(c){d.clearTimeout(c)};this.convertToMessages=function(c){if(l.isString(c))try{return JSON.parse(c)}catch(u){throw this._debug("Could not convert to JSON the following string",'"'+c+'"'),u;}if(l.isArray(c))return c;if(void 0===c||null===c)return[];if(c instanceof Object)return[c];throw"Conversion Error "+
c+", typeof "+typeof c;};this.accept=function(c,b,d){throw"Abstract";};this.getType=function(){return b};this.getURL=function(){return c};this.setURL=function(b){c=b};this.send=function(c,b){throw"Abstract";};this.reset=function(c){this._debug("Transport",b,"reset",c?"initial":"retry")};this.abort=function(){this._debug("Transport",b,"aborted")};this.toString=function(){return this.getType()}};w.derive=function(b){function d(){}d.prototype=b;return new d};var D=function(){function b(c){for(;0<y.length;){var b=
y[0],d=b[0];b=b[1];if(d.url===c.url&&d.sync===c.sync)y.shift(),c.messages=c.messages.concat(d.messages),this._debug("Coalesced",d.messages.length,"messages from request",b.id);else break}}function d(c,b){this.transportSend(c,b);b.expired=!1;if(!c.sync){var d=this.getConfiguration().maxNetworkDelay,e=d;!0===b.metaConnect&&(e+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"waiting at most",e,"ms for the response, maxNetworkDelay",d);var g=this;b.timeout=this.setTimeout(function(){b.expired=
!0;var d="Request "+b.id+" of transport "+g.getType()+" exceeded "+e+" ms max network delay",r={reason:d},k=b.xhr;r.httpCode=g.xhrStatus(k);g.abortXHR(k);g._debug(d);g.complete(b,!1,b.metaConnect);c.onFailure(k,c.messages,r)},e)}}function c(c){var b=++m,g={id:b,metaConnect:!1,envelope:c};v.length<this.getConfiguration().maxConnections-1?(v.push(g),d.call(this,c,g)):(this._debug("Transport",this.getType(),"queueing request",b,"envelope",c),y.push([c,g]))}function g(d,g){var e=l.inArray(d,v);0<=e&&
v.splice(e,1);if(0<y.length){e=y.shift();var k=e[0],r=e[1];this._debug("Transport dequeued request",r.id);if(g)this.getConfiguration().autoBatch&&b.call(this,k),c.call(this,k),this._debug("Transport completed request",d.id,k);else{var u=this;this.setTimeout(function(){u.complete(r,!1,r.metaConnect);var c={reason:"Previous request failed"},b=r.xhr;c.httpCode=u.xhrStatus(b);k.onFailure(b,k.messages,c)},0)}}}var e=new w,k=w.derive(e),m=0,n=null,v=[],y=[];k.complete=function(c,b,d){if(d){c=c.id;this._debug("Transport",
this.getType(),"/meta/connect complete, request",c);if(null!==n&&n.id!==c)throw"/meta/connect request mismatch, completing request "+c;n=null}else g.call(this,c,b)};k.transportSend=function(c,b){throw"Abstract";};k.transportSuccess=function(c,b,d){if(!b.expired)if(this.clearTimeout(b.timeout),this.complete(b,!0,b.metaConnect),d&&0<d.length)c.onSuccess(d);else c.onFailure(b.xhr,c.messages,{httpCode:204})};k.transportFailure=function(c,b,d){b.expired||(this.clearTimeout(b.timeout),this.complete(b,!1,
b.metaConnect),c.onFailure(b.xhr,c.messages,d))};k.send=function(b,g){if(g){if(null!==n)throw"Concurrent /meta/connect requests not allowed, request id="+n.id+" not yet completed";g=++m;this._debug("Transport",this.getType(),"/meta/connect send, request",g,"envelope",b);g={id:g,metaConnect:!0,envelope:b};d.call(this,b,g);n=g}else c.call(this,b)};k.abort=function(){e.abort();for(var c=0;c<v.length;++c){var b=v[c];b&&(this._debug("Aborting request",b),this.abortXHR(b.xhr)||this.transportFailure(b.envelope,
b,{reason:"abort"}))}if(c=n)this._debug("Aborting /meta/connect request",c),this.abortXHR(c.xhr)||this.transportFailure(c.envelope,c,{reason:"abort"});this.reset(!0)};k.reset=function(c){e.reset(c);n=null;v=[];y=[]};k.abortXHR=function(c){if(c)try{var b=c.readyState;c.abort();return b!==window.XMLHttpRequest.UNSENT}catch(Ea){this._debug(Ea)}return!1};k.xhrStatus=function(c){if(c)try{return c.status}catch(Da){this._debug(Da)}return-1};return k},O=function(){var b=new D,d=w.derive(b),c=!0;d.accept=
function(b,d,e){return c||!d};d.newXMLHttpRequest=function(){return new window.XMLHttpRequest};d.xhrSend=function(c){var b=d.newXMLHttpRequest();b.context=d.context;b.withCredentials=!0;b.open("POST",c.url,!0!==c.sync);var e=c.headers;if(e)for(var g in e)e.hasOwnProperty(g)&&b.setRequestHeader(g,e[g]);b.setRequestHeader("Content-Type","application/json;charset=UTF-8");b.onload=function(){if(200===b.status)c.onSuccess(b.responseText);else c.onError(b.statusText)};b.onerror=function(){c.onError(b.statusText)};
b.send(c.body);return b};d.transportSend=function(b,d){this._debug("Transport",this.getType(),"sending request",d.id,"envelope",b);var e=this;try{var g=!0;d.xhr=this.xhrSend({transport:this,url:b.url,sync:b.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(b.messages),onSuccess:function(g){e._debug("Transport",e.getType(),"received response",g);var k=!1;try{var l=e.convertToMessages(g);0===l.length?(c=!1,e.transportFailure(b,d,{httpCode:204})):(k=!0,e.transportSuccess(b,d,l))}catch(r){e._debug(r),
k||(c=!1,g={exception:r},g.httpCode=e.xhrStatus(d.xhr),e.transportFailure(b,d,g))}},onError:function(k,l){e._debug("Transport",e.getType(),"received error",k,l);c=!1;var u={reason:k,exception:l};u.httpCode=e.xhrStatus(d.xhr);g?e.setTimeout(function(){e.transportFailure(b,d,u)},0):e.transportFailure(b,d,u)}});g=!1}catch(n){c=!1,this.setTimeout(function(){e.transportFailure(b,d,{exception:n})},0)}};d.reset=function(d){b.reset(d);c=!0};return d},U="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),
da=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:function(b){function d(a,f){try{return a[f]}catch(t){}}function c(a){return void 0===a||null===a?!1:"function"===typeof a}function g(a,f){for(var c="";0<--f&&!(a>=Math.pow(10,f));)c+="0";return c+a}function u(a,f){if(window.console&&
(a=window.console[a],c(a))){var b=new Date;[].splice.call(f,0,0,g(b.getHours(),2)+":"+g(b.getMinutes(),2)+":"+g(b.getSeconds(),2)+"."+g(b.getMilliseconds(),3));a.apply(window.console,f)}}function k(a){return/(^https?:\/\/)?(((\[[^\]]+])|([^:/?#]+))(:(\d+))?)?([^?#]*)(.*)?/.exec(a)}function w(a){h._debug("Configuring cometd object with",a);l.isString(a)&&(a={url:a});a||(a={});q=h._mixin(!1,q,a);a=h.getURL();if(!a)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";
var f=k(a);a=f[8];var c=f[9];Y=h._isCrossDomain(f[2]);q.appendMessageTypeToURL&&(void 0!==c&&0<c.length?(h._info("Appending message type to URI "+a+c+" is not supported, disabling 'appendMessageTypeToURL' configuration"),q.appendMessageTypeToURL=!1):(f=a.split("/"),c=f.length-1,a.match(/\/$/)&&--c,0<=f[c].indexOf(".")&&(h._info("Appending message type to URI "+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),q.appendMessageTypeToURL=!1)));if(window.Worker&&window.Blob&&window.URL&&
q.useWorkerScheduler){a=e.toString();a=a.substring(a.indexOf("{")+1,a.lastIndexOf("}"));a=new window.Blob([a],{type:"application/json"});a=window.URL.createObjectURL(a);var b=new window.Worker(a);J.setTimeout=function(a,f){a=J.register(a);b.postMessage({id:a,type:"setTimeout",delay:f});return a};J.clearTimeout=function(a){J.unregister(a);b.postMessage({id:a,type:"clearTimeout"})};b.onmessage=function(a){(a=J.unregister(a.data.id))&&a()}}}function n(a){if(a){var f=G[a.channel];f&&f[a.id]&&(delete f[a.id],
h._debug("Removed",a.listener?"listener":"subscription",a))}}function v(){for(var a in G)if(G.hasOwnProperty(a)){var f=G[a];if(f)for(var c in f)if(f.hasOwnProperty(c)){var b=f[c];b&&!b.listener&&n(b)}}}function y(a){L!==a&&(h._debug("Status",L,"->",a),L=a)}function r(){return"disconnecting"===L||"disconnected"===L}function D(a,f,b,z,d){try{return f.call(a,z)}catch(K){a=h.onExtensionException;if(c(a)){h._debug("Invoking extension exception handler",b,K);try{a.call(h,K,b,d,z)}catch(ea){h._info("Exception during execution of extension exception handler",
b,ea)}}else h._info("Exception during execution of extension",b,K);return z}}function U(a){for(var f=B.length-1;0<=f&&void 0!==a&&null!==a;--f){var b=B[f],z=b.extension.outgoing;c(z)&&(b=D(b.extension,z,b.name,a,!0),a=void 0===b?a:b)}return a}function ca(a,f){if(a=G[a])for(var b in a)if(a.hasOwnProperty(b)){var z=a[b];if(z)try{z.callback.call(z.scope,f)}catch(K){var d=h.onListenerException;if(c(d)){h._debug("Invoking listener exception handler",z,K);try{d.call(h,K,z,z.listener,f)}catch(ea){h._info("Exception during execution of listener exception handler",
z,ea)}}else h._info("Exception during execution of listener",z,f,K)}}}function x(a,f){ca(a,f);a=a.split("/");for(var c=a.length-1,b=c;0<b;--b){var d=a.slice(0,b).join("/")+"/*";b===c&&ca(d,f);d+="*";ca(d,f)}}function ma(a,f){null!==M&&h.clearTimeout(M);M=null;f=A.interval+f;h._debug("Function scheduled in",f,"ms, interval =",A.interval,"backoff =",E,a);M=h.setTimeout(a,f)}function S(a,f,c){for(var b=0;b<a.length;++b){var d=a[b],t=d.id;P&&(d.clientId=P);d=U(d);void 0!==d&&null!==d?(d.id=t,a[b]=d):
(delete Z[t],a.splice(b--,1))}0!==a.length&&(b=h.getURL(),q.appendMessageTypeToURL&&(b.match(/\/$/)||(b+="/"),c&&(b+=c)),a={url:b,sync:!1,messages:a,onSuccess:function(a){try{Ga.call(h,a)}catch(Ha){h._info("Exception during handling of messages",Ha)}},onFailure:function(a,f,c){try{var b=h.getTransport();c.connectionType=b?b.getType():"unknown";na.call(h,a,f,c)}catch(Ia){h._info("Exception during handling of failure",Ia)}}},h._debug("Send",a),p.send(a,f))}function T(a){0<I||!0===V?Q.push(a):S([a],
!1)}function oa(){var a=Q;Q=[];0<a.length&&S(a,!1)}function pa(){if(!r()){var a={id:""+ ++N,channel:"/meta/connect",connectionType:p.getType()};aa||(a.advice={timeout:0});y("connecting");h._debug("Connect sent",a);S([a],!0,"connect");y("connected")}}function ba(a){y("connecting");ma(function(){pa()},a)}function qa(a){a&&(A=h._mixin(!1,{},q.advice,a),h._debug("New advice",A))}function W(a){null!==M&&h.clearTimeout(M);M=null;a&&p&&p.abort();Y=!1;p=null;y("disconnected");P=null;E=I=0;aa=fa=!1;X=0;0<
Q.length&&(a=Q,Q=[],na.call(h,void 0,a,{reason:"Disconnected"}))}function ha(a,f,b){var d=h.onTransportException;if(c(d)){h._debug("Invoking transport exception handler",a,f,b);try{d.call(h,b,a,f)}catch(Fa){h._info("Exception during execution of transport exception handler",Fa)}}}function ra(a,f){c(a)&&(f=a,a=void 0);P=null;v();r()&&F.reset(!0);qa({});I=0;V=!0;ia=a;sa=f;a=h.getURL();var b=F.findTransportTypes("1.0",Y,a),d={id:""+ ++N,version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:b,
advice:{timeout:A.timeout,interval:A.interval}};d=h._mixin(!1,{},ia,d);h._putCallback(d.id,f);if(!p&&(p=F.negotiateTransport(b,"1.0",Y,a),!p))throw f="Could not find initial transport among: "+F.getTransportTypes(),h._warn(f),f;h._debug("Initial transport is",p.getType());y("handshaking");h._debug("Handshake sent",d);S([d],!1,"handshake")}function da(a){y("handshaking");V=!0;ma(function(){ra(ia,sa)},a)}function ta(a,f){try{a.call(h,f)}catch(t){if(a=h.onCallbackException,c(a)){h._debug("Invoking callback exception handler",
t);try{a.call(h,t,f)}catch(z){h._info("Exception during execution of callback exception handler",z)}}else h._info("Exception during execution of message callback",t)}}function H(a){var f=h._getCallback([a.id]);c(f)&&(delete Z[a.id],ta(f,a))}function ua(a){var f=ja[a.id];delete ja[a.id];if(f){h._debug("Handling remote call response for",a,"with context",f);var b=f.timeout;b&&h.clearTimeout(b);f=f.callback;if(c(f))return ta(f,a),!0}return!1}function va(a){h._debug("Transport failure handling",a);a.transport&&
(p=a.transport);a.url&&p.setURL(a.url);var f=a.action;a=a.delay||0;switch(f){case "handshake":da(a);break;case "retry":ba(a);break;case "none":W(!0);break;default:throw"Unknown action "+f;}}function ka(a,f){H(a);x("/meta/handshake",a);x("/meta/unsuccessful",a);r()&&(f.action="none");h.onTransportFailure.call(h,a,f,va)}function wa(a,f){x("/meta/connect",a);x("/meta/unsuccessful",a);r()&&(f.action="none");h.onTransportFailure.call(h,a,f,va)}function xa(a){W(!0);H(a);x("/meta/disconnect",a);x("/meta/unsuccessful",
a)}function ya(a){var f=G[a.subscription];if(f)for(var b in f)if(f.hasOwnProperty(b)){var c=f[b];c&&!c.listener&&(delete f[b],h._debug("Removed failed subscription",c))}H(a);x("/meta/subscribe",a);x("/meta/unsuccessful",a)}function za(a){H(a);x("/meta/unsubscribe",a);x("/meta/unsuccessful",a)}function la(a){ua(a)||(H(a),x("/meta/publish",a),x("/meta/unsuccessful",a))}function Aa(a){for(var b=X=0;b<B.length&&void 0!==a&&null!==a;++b){var d=B[b],e=d.extension.incoming;c(e)&&(d=D(d.extension,e,d.name,
a,!1),a=void 0===d?a:d)}if(void 0!==a&&null!==a)switch(qa(a.advice),a.channel){case "/meta/handshake":b=h.getURL();if(a.successful)if(d=h._isCrossDomain(k(b)[2]),b=F.negotiateTransport(a.supportedConnectionTypes,a.version,d,b),null===b)a.successful=!1,ka(a,{cause:"negotiation",action:"none",transport:null});else switch(p!==b&&(h._debug("Transport",p.getType(),"->",b.getType()),p=b),P=a.clientId,V=!1,oa(),a.reestablish=fa,fa=!0,H(a),x("/meta/handshake",a),R=a["x-messages"]||0,a=r()?"none":A.reconnect||
"retry",a){case "retry":E=0;0===R?ba(0):h._debug("Processing",R,"handshake-delivered messages");break;case "none":W(!0);break;default:throw"Unrecognized advice action "+a;}else ka(a,{cause:"unsuccessful",action:A.reconnect||"handshake",transport:p});break;case "/meta/connect":if(aa=a.successful)switch(x("/meta/connect",a),a=r()?"none":A.reconnect||"retry",a){case "retry":E=0;ba(E);break;case "none":W(!1);break;default:throw"Unrecognized advice action "+a;}else wa(a,{cause:"unsuccessful",action:A.reconnect||
"retry",transport:p});break;case "/meta/disconnect":a.successful?(W(!1),H(a),x("/meta/disconnect",a)):xa(a);break;case "/meta/subscribe":a.successful?(H(a),x("/meta/subscribe",a)):ya(a);break;case "/meta/unsubscribe":a.successful?(H(a),x("/meta/unsubscribe",a)):za(a);break;default:void 0!==a.data?ua(a)||(x(a.channel,a),0<R&&(--R,0===R&&(h._debug("Processed last handshake-delivered message"),ba(0)))):void 0===a.successful?h._warn("Unknown Bayeux Message",a):a.successful?(H(a),x("/meta/publish",a)):
la(a)}}function Ba(a,b){var f={scope:a,method:b};if(c(a))f.scope=void 0,f.method=a;else if(l.isString(b)){if(!a)throw"Invalid scope "+a;f.method=a[b];if(!c(f.method))throw"Invalid callback "+b+" for scope "+a;}else if(!c(b))throw"Invalid callback "+b;return f}function Ca(a,b,c,d){c=Ba(b,c);h._debug("Adding",d?"listener":"subscription","on",a,"with scope",c.scope,"and callback",c.method);b=++Ja;c={id:b,channel:a,scope:c.scope,callback:c.method,listener:d};var f=G[a];f||(f={},G[a]=f);f[b]=c;h._debug("Added",
d?"listener":"subscription",c);return c}var J=new m,h=this,Ka=b||"default",Y=!1,F=new C,p,L="disconnected",N=0,P=null,I=0,Q=[],V=!1,Ja=0,G={},E=0,M=null,B=[],A={},ia,sa,Z={},ja={},fa=!1,aa=!1,X=0,R=0,q={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2E3,advice:{timeout:6E4,interval:0,reconnect:void 0,maxInterval:0}};
this._mixin=function(a,b,c){for(var f=b||{},e=2;e<arguments.length;++e){var h=arguments[e];if(void 0!==h&&null!==h)for(var t in h)if(h.hasOwnProperty(t)){var g=d(h,t),k=d(f,t);g!==b&&void 0!==g&&(f[t]=a&&"object"===typeof g&&null!==g?g instanceof Array?this._mixin(a,k instanceof Array?k:[],g):this._mixin(a,"object"!==typeof k||k instanceof Array?{}:k,g):g)}}return f};this._warn=function(){u("warn",arguments)};this._info=function(){"warn"!==q.logLevel&&u("info",arguments)};this._debug=function(){"debug"===
q.logLevel&&u("debug",arguments)};this._isCrossDomain=function(a){return window.location&&window.location.host&&a?a!==window.location.host:!1};this.send=T;this.connectNow=function(){return pa()};this._getCallback=function(a){return Z[a]};this._putCallback=function(a,b){var f=this._getCallback(a);c(b)&&(Z[a]=b);return f};this.onTransportFailure=function(a,b,c){this._debug("Transport failure",b,"for",a);var f=this.getTransportRegistry(),d=this.getURL(),e=this._isCrossDomain(k(d)[2]),g=f.findTransportTypes("1.0",
e,d);"none"===b.action?"/meta/handshake"!==a.channel||b.transport||(f="Could not negotiate transport, client=["+g+"], server=["+a.supportedConnectionTypes+"]",this._warn(f),ha(p.getType(),null,{reason:f,connectionType:p.getType(),transport:p})):(b.delay=this.getBackoffPeriod(),"/meta/handshake"===a.channel?(b.transport||((f=f.negotiateTransport(g,"1.0",e,d))?(this._debug("Transport",p.getType(),"->",f.getType()),ha(p.getType(),f.getType(),a.failure),b.action="handshake",b.transport=f):(this._warn("Could not negotiate transport, client=["+
g+"]"),ha(p.getType(),null,a.failure),b.action="none")),"none"!==b.action&&this.increaseBackoffPeriod()):(a=(new Date).getTime(),0===X&&(X=a),"retry"===b.action&&(b.delay=this.increaseBackoffPeriod(),g=A.maxInterval,0<g&&a-X+E>A.timeout+A.interval+g&&(b.action="handshake")),"handshake"===b.action&&(b.delay=0,f.reset(!1),this.resetBackoffPeriod())));c.call(h,b)};this.receive=Aa;var Ga=function(a){h._debug("Received",a);for(var b=0;b<a.length;++b)Aa(a[b])};var na=function(a,b,c){h._debug("handleFailure",
a,b,c);c.transport=a;for(a=0;a<b.length;++a){var f=b[a],d={id:f.id,successful:!1,channel:f.channel,failure:c};c.message=f;switch(f.channel){case "/meta/handshake":ka(d,{cause:"failure",action:"handshake",transport:null});break;case "/meta/connect":f=d;aa=!1;wa(f,{cause:"failure",action:"retry",transport:null});break;case "/meta/disconnect":xa(d);break;case "/meta/subscribe":d.subscription=f.subscription;ya(d);break;case "/meta/unsubscribe":d.subscription=f.subscription;za(d);break;default:la(d)}}};
this.registerTransport=function(a,b,d){if(d=F.add(a,b,d))this._debug("Registered transport",a),c(b.registered)&&b.registered(a,this);return d};this.unregisterTransport=function(a){var b=F.remove(a);null!==b&&(this._debug("Unregistered transport",a),c(b.unregistered)&&b.unregistered());return b};this.unregisterTransports=function(){F.clear()};this.getTransportTypes=function(){return F.getTransportTypes()};this.findTransport=function(a){return F.find(a)};this.getTransportRegistry=function(){return F};
this.configure=function(a){w.call(this,a)};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=function(a,b){if("disconnected"!==L)throw"Illegal state: handshaken";ra(a,b)};this.disconnect=function(a,b){if(!r()){c(a)&&(b=a,a=void 0);var f={id:""+ ++N,channel:"/meta/disconnect"};a=this._mixin(!1,{},a,f);h._putCallback(a.id,b);y("disconnecting");S([a],!1,"disconnect")}};this.startBatch=function(){++I;h._debug("Starting batch, depth",I)};this.endBatch=function(){--I;h._debug("Ending batch, depth",
I);if(0>I)throw"Calls to startBatch() and endBatch() are not paired";0!==I||r()||V||oa()};this.batch=function(a,b){a=Ba(a,b);this.startBatch();try{a.method.call(a.scope),this.endBatch()}catch(t){throw this._info("Exception during execution of batch",t),this.endBatch(),t;}};this.addListener=function(a,b,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!l.isString(a))throw"Illegal argument type: channel must be a string";return Ca(a,b,c,!0)};this.removeListener=
function(a){if(!(a&&a.channel&&"id"in a))throw"Invalid argument: expected subscription, not "+a;n(a)};this.clearListeners=function(){G={}};this.subscribe=function(a,b,d,e,g){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!l.isString(a))throw"Illegal argument type: channel must be a string";if(r())throw"Illegal state: disconnected";c(b)&&(g=e,e=d,d=b,b=void 0);c(e)&&(g=e,e=void 0);var f=Ca(a,b,d,!1),t={id:""+ ++N,channel:a.startsWith("/slim")?a:"/meta/subscribe",
subscription:a.startsWith("/slim")?void 0:a};t=this._mixin(!1,{},e,t);h._putCallback(t.id,g);T(t);return f};this.unsubscribe=function(a,b,d){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(r())throw"Illegal state: disconnected";c(b)&&(d=b,b=void 0);this.removeListener(a);var f=a.channel,e;a:{if(e=G[f])for(var g in e)if(e.hasOwnProperty(g)&&e[g]){e=!0;break a}e=!1}e||(f={id:""+ ++N,channel:"/meta/unsubscribe",subscription:f},f=this._mixin(!1,{},b,f),h._putCallback(f.id,
d),T(f))};this.resubscribe=function(a,b){a&&!a.listener&&n(a);if(a)return this.subscribe(a.channel,a.scope,a.callback,b)};this.clearSubscriptions=function(){v()};this.publish=function(a,b,d,e){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!l.isString(a))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(a))throw"Illegal argument: cannot publish to meta channels";if(r())throw"Illegal state: disconnected";c(b)?(e=b,b={},d=void 0):
c(d)&&(e=d,d=void 0);var f={id:""+ ++N,channel:a,data:b};f=this._mixin(!1,{},d,f);h._putCallback(f.id,e);T(f)};this.publishBinary=function(a,b,d,e,g){c(b)?(g=b,b=new ArrayBuffer(0),d=!0,e=void 0):c(d)?(g=d,d=!0,e=void 0):c(e)&&(g=e,e=void 0);this.publish(a,{meta:e,data:b,last:d},{ext:{binary:{}}},g)};this.remoteCall=function(a,b,d,e,g){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!l.isString(a))throw"Illegal argument type: target must be a string";if(r())throw"Illegal state: disconnected";
c(b)?(g=b,b={},d=q.maxNetworkDelay,e=void 0):c(d)?(g=d,d=q.maxNetworkDelay,e=void 0):c(e)&&(g=e,e=void 0);if("number"!==typeof d)throw"Illegal argument type: timeout must be a number";a.match(/^\//)||(a="/"+a);var f={id:""+ ++N,channel:"/service"+a,data:b},k=this._mixin(!1,{},e,f);f={callback:g};0<d&&(f.timeout=h.setTimeout(function(){h._debug("Timing out remote call",k,"after",d,"ms");la({id:k.id,error:"406::timeout",successful:!1,failure:{message:k,reason:"Remote Call Timeout"}})},d),h._debug("Scheduled remote call timeout",
k,"in",d,"ms"));ja[k.id]=f;T(k)};this.remoteCallBinary=function(a,b,d,e,g,h){c(b)?(h=b,b=new ArrayBuffer(0),d=!0,e=void 0,g=q.maxNetworkDelay):c(d)?(h=d,d=!0,e=void 0,g=q.maxNetworkDelay):c(e)?(h=e,e=void 0,g=q.maxNetworkDelay):c(g)&&(h=g,g=q.maxNetworkDelay);this.remoteCall(a,{meta:e,data:b,last:d},g,{ext:{binary:{}}},h)};this.getStatus=function(){return L};this.isDisconnected=r;this.setBackoffIncrement=function(a){q.backoffIncrement=a};this.getBackoffIncrement=function(){return q.backoffIncrement};
this.getBackoffPeriod=function(){return E};this.increaseBackoffPeriod=function(){E<q.maxBackoff&&(E+=q.backoffIncrement);return E};this.resetBackoffPeriod=function(){E=0};this.setMaxBackoff=function(a){q.maxBackoff=a};this.setLogLevel=function(a){q.logLevel=a};this.registerExtension=function(a,b){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!l.isString(a))throw"Illegal argument type: extension name must be a string";for(var d=!1,f=0;f<B.length;++f)if(B[f].name===
a){d=!0;break}if(d)return this._info("Could not register extension with name",a,"since another extension with the same name already exists"),!1;B.push({name:a,extension:b});this._debug("Registered extension",a);c(b.registered)&&b.registered(a,this);return!0};this.unregisterExtension=function(a){if(!l.isString(a))throw"Illegal argument type: extension name must be a string";for(var b=!1,d=0;d<B.length;++d){var e=B[d];if(e.name===a){B.splice(d,1);b=!0;this._debug("Unregistered extension",a);a=e.extension;
c(a.unregistered)&&a.unregistered();break}}return b};this.getExtension=function(a){for(var b=0;b<B.length;++b){var c=B[b];if(c.name===a)return c.extension}return null};this.getName=function(){return Ka};this.getClientId=function(){return P};this.getURL=function(){if(p){var a=p.getURL();if(a||(a=q.urls[p.getType()]))return a}return q.url};this.getTransport=function(){return p};this.getConfiguration=function(){return this._mixin(!0,{},q)};this.getAdvice=function(){return this._mixin(!0,{},A)};this.setTimeout=
function(a,b){return J.setTimeout(function(){try{h._debug("Invoking timed function",a),a()}catch(t){h._debug("Exception invoking timed function",a,t)}},b)};this.clearTimeout=function(a){J.clearTimeout(a)};this.registerTransport("long-polling",new O)},Transport:w,RequestTransport:D,LongPollingTransport:O,Utils:l,Z85:{encode:function(b){var d=null;b instanceof ArrayBuffer?d=b:b.buffer instanceof ArrayBuffer?d=b.buffer:Array.isArray(b)&&(d=(new Uint8Array(b)).buffer);if(null==d)throw"Cannot Z85 encode "+
b;b=d.byteLength;var c=b%4;c=4-(0===c?4:c);d=new DataView(d);for(var e="",l=0,k=0;k<b+c;++k){var m=k>=b;l=256*l+(m?0:d.getUint8(k));if(0===(k+1)%4){for(var n=52200625,v=5;0<v;--v){if(!m||v>c)e+=U[Math.floor(l/n)%85];n/=85}l=0}}return e},decode:function(b){var d=b.length%5,c=5-(0===d?5:d);for(d=0;d<c;++d)b+=U[U.length-1];d=b.length;c=new ArrayBuffer(4*d/5-c);for(var e=new DataView(c),l=0,k=0,m=0,n=0;n<d;++n){var v=b.charCodeAt(k++)-32;l=85*l+da[v];if(0===k%5){for(v=16777216;1<=v;)m<e.byteLength&&e.setUint8(m++,
Math.floor(l/v)%256),v/=256;l=0}}return c}}}});
