Vue.component("lms-volume",{template:'\n<v-sheet v-model="show" v-if="show" elevation="5" class="vol-sheet">\n <v-container grid-list-md text-xs-center>\n  <v-layout row wrap>\n   <v-flex xs12 class="vol-text">{{playerVolume}}%</v-flex xs12>\n   <v-flex xs12>\n    <v-layout>\n     <v-btn flat icon @click.stop="volumeDown" class="vol-btn"><v-icon>{{muted ? \'volume_off\' : \'volume_down\'}}</v-icon></v-btn>\n     <v-slider step="1" v-model="playerVolume" @click.stop="setVolume" class="vol-slider" @start="volumeSliderStart" @end="volumeSliderEnd"></v-slider>\n     <v-btn flat icon @click.stop="volumeUp" class="vol-btn"><v-icon>{{muted ? \'volume_off\' : \'volume_up\'}}</v-icon></v-btn>\n    </v-layout>\n   </v-flex>\n  </v-layout>\n </v-container>\n <v-card-actions>\n  <v-btn flat @click.native="toggleMute()">{{muted ? i18n(\'Unmute\') : i18n(\'Mute\')}}</v-btn>\n  <v-spacer></v-spacer>\n  <v-btn flat @click.native="show = false">{{i18n(\'Close\')}}</v-btn>\n </v-card-actions>\n</v-sheet>\n    ',
props:[],data:function(){return{show:!1,playerVolume:0,muted:!1}},mounted:function(){this.closeTimer=void 0;bus.$on("playerStatus",function(a){this.show&&!this.movingVolumeSlider&&(this.muted=0>a.volume,a=Math.abs(a.volume),a!=this.playerVolume&&(this.playerVolume=a))}.bind(this));bus.$on("volume.open",function(){var a=this;this.show?this.close():lmsCommand(this.$store.state.player.id,["mixer","volume","?"]).then(function(b){(b=b.data)&&b.result&&b.result._volume&&(b=parseInt(b.result._volume),a.muted=
0>b,b=Math.abs(b),a.playerVolume=b,a.movingVolumeSlider=!1,a.show=!0,a.resetCloseTimer())})}.bind(this));bus.$on("noPlayers",function(){this.close()}.bind(this));bus.$on("esc",function(){"volume"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this));bus.$on("dialogOpen",function(a,b){b&&"volume"!=a&&this.close()}.bind(this));bus.$on("menuOpen",function(){this.close()}.bind(this))},beforeDestroy:function(){this.cancelCloseTimer()},methods:{close:function(){this.show=!1;this.cancelCloseTimer()},
volumeDown:function(){bus.$emit("playerCommand",["mixer","volume",adjustVolume(Math.abs(this.playerVolume),!1)]);this.resetCloseTimer()},volumeUp:function(){bus.$emit("playerCommand",["mixer","volume",adjustVolume(Math.abs(this.playerVolume),!0)]);this.resetCloseTimer()},setVolume:function(){bus.$emit("playerCommand",["mixer","volume",this.playerVolume]);this.resetCloseTimer()},toggleMute:function(){bus.$emit("playerCommand",["mixer","muting","toggle"]);this.resetCloseTimer()},i18n:function(a){return this.show?
i18n(a):a},volumeSliderStart:function(){this.movingVolumeSlider=!0;this.cancelCloseTimer()},volumeSliderEnd:function(){var a=this;this.$store.state.player?lmsCommand(this.$store.state.player.id,["mixer","volume",this.playerVolume]).then(function(b){bus.$emit("updatePlayer",a.$store.state.player.id);a.movingVolumeSlider=!1}).catch(function(b){bus.$emit("updatePlayer",a.$store.state.player.id);a.movingVolumeSlider=!1}):this.movingVolumeSlider=!1;this.resetCloseTimer();this.cancelSendVolumeTimer()},
cancelCloseTimer:function(){void 0!==this.closeTimer&&(clearTimeout(this.closeTimer),this.closeTimer=void 0)},resetCloseTimer:function(){this.cancelCloseTimer();this.closeTimer=setTimeout(function(){this.show=!1}.bind(this),LMS_VOLUME_CLOSE_TIMEOUT)},cancelSendVolumeTimer:function(){void 0!==this.sendVolumeTimer&&(clearTimeout(this.sendVolumeTimer),this.sendVolumeTimer=void 0)},resetSendVolumeTimer:function(){this.cancelSendVolumeTimer();this.sendVolumeTimer=setTimeout(function(){bus.$emit("playerCommand",
["mixer","volume",this.playerVolume])}.bind(this),LMS_VOLUME_DEBOUNCE)}},watch:{playerVolume:function(a){this.show&&0<=a&&(this.movingVolumeSlider||this.resetCloseTimer(),this.resetSendVolumeTimer())},show:function(a){this.$store.commit("dialogOpen",{name:"volume",shown:a});this.resetCloseTimer();this.cancelSendVolumeTimer()}}});
