Vue.component("lms-sleep-dialog",{template:'\n<v-dialog v-model="show" v-if="show" persistent width="450" class="lms-dialog">\n <v-card>\n  <v-card-text>\n   <v-container grid-list-md style="padding: 4px">\n    <v-layout wrap>\n     <v-flex xs12 v-if="undefined==player">{{i18n("Set sleep time for all players.")}}</v-flex>\n     <v-flex xs12 v-else>{{i18n("Set sleep time for \'%1\'.", player.name)}}</v-flex>\n     <v-flex xs12>\n      <v-list class="sleep-list">\n       <template v-for="(item, index) in items">\n        <v-list-tile @click="setSleep(item.duration)">\n         <v-list-tile-title>{{item.label}}</v-list-tile-title>\n        </v-list-tile>\n        <v-divider></v-divider>\n        </template>\n      </v-list>\n     </v-flex>\n    </v-layout>\n   </v-container>\n  </v-card-text>\n  <v-card-actions>\n   <p v-if="undefined!=sleepTime">{{i18n("%1 until sleep", formatSeconds(sleepTime))}}</p>\n   <v-spacer></v-spacer>\n   <v-btn flat @click.native="cancel()">{{i18n(\'Cancel\')}}</v-btn>\n  </v-card-actions>\n </v-card>\n</v-dialog>\n',
props:[],data:function(){return{show:!1,player:void 0,items:[],sleepTime:void 0}},mounted:function(){bus.$on("sleep.open",function(a){var b=this;this.player=a;this.sleepTime=void 0;this.show=!0;void 0!=this.player&&lmsCommand(this.player.id,["sleep","?"]).then(function(a){(a=a.data)&&a.result&&a.result._sleep&&(b.sleepTime=parseInt(a.result._sleep),b.timeLeft=b.sleepTime,b.start=new Date,b.timer=setInterval(function(){var a=((new Date).getTime()-this.start.getTime())/1E3;this.sleepTime=this.timeLeft-
a;0>=this.sleepTime&&(this.sleepTime=void 0,this.cancelTimer())}.bind(b),1E3))})}.bind(this));bus.$on("langChanged",function(){this.initItems()}.bind(this));this.initItems();bus.$on("noPlayers",function(){this.show=!1}.bind(this));bus.$on("esc",function(){"sleep"==this.$store.state.activeDialog&&(this.show=!1)}.bind(this))},methods:{initItems:function(){this.items=[{duration:0,label:i18n("Do not sleep")},{duration:900,label:i18n("%1 minutes",15)},{duration:1800,label:i18n("%1 minutes",30)},{duration:2700,
label:i18n("%1 minutes",45)},{duration:3600,label:i18n("%1 minutes",60)},{duration:5400,label:i18n("%1 minutes",90)},{duration:-1,label:i18n("Remaining duration of current track")}]},cancel:function(){this.show=!1;this.cancelTimer()},setSleep:function(a){var b=this;void 0==this.player?this.$store.state.players.forEach(function(b){b.isgroup||lmsCommand(b.id,-1==a?["jiveendoftracksleep"]:["sleep",a]).then(function(a){bus.$emit("updatePlayer",b.id)})}):lmsCommand(this.player.id,-1==a?["jiveendoftracksleep"]:
["sleep",a]).then(function(a){bus.$emit("updatePlayer",b.player.id)});this.show=!1;this.cancelTimer()},i18n:function(a,b){return this.show?i18n(a,b):a},cancelTimer:function(){void 0!==this.timer&&(clearInterval(this.timer),this.timer=void 0)}},beforeDestroy:function(){this.cancelTimer()},watch:{show:function(a){this.$store.commit("dialogOpen",{name:"sleep",shown:a})}}});
